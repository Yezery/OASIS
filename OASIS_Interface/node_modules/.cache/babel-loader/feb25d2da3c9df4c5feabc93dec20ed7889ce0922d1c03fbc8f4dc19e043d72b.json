{"ast":null,"code":"require(\"core-js/modules/es.array.push.js\");\nrequire(\"core-js/modules/es.array.unshift.js\");\nconst RateLimiterQueueError = require('./component/RateLimiterQueueError');\nconst MAX_QUEUE_SIZE = 4294967295;\nconst KEY_DEFAULT = 'limiter';\nmodule.exports = class RateLimiterQueue {\n  constructor(limiterFlexible, opts = {\n    maxQueueSize: MAX_QUEUE_SIZE\n  }) {\n    this._queueLimiters = {\n      KEY_DEFAULT: new RateLimiterQueueInternal(limiterFlexible, opts)\n    };\n    this._limiterFlexible = limiterFlexible;\n    this._maxQueueSize = opts.maxQueueSize;\n  }\n  getTokensRemaining(key = KEY_DEFAULT) {\n    if (this._queueLimiters[key]) {\n      return this._queueLimiters[key].getTokensRemaining();\n    } else {\n      return Promise.resolve(this._limiterFlexible.points);\n    }\n  }\n  removeTokens(tokens, key = KEY_DEFAULT) {\n    if (!this._queueLimiters[key]) {\n      this._queueLimiters[key] = new RateLimiterQueueInternal(this._limiterFlexible, {\n        key,\n        maxQueueSize: this._maxQueueSize\n      });\n    }\n    return this._queueLimiters[key].removeTokens(tokens);\n  }\n};\nclass RateLimiterQueueInternal {\n  constructor(limiterFlexible, opts = {\n    maxQueueSize: MAX_QUEUE_SIZE,\n    key: KEY_DEFAULT\n  }) {\n    this._key = opts.key;\n    this._waitTimeout = null;\n    this._queue = [];\n    this._limiterFlexible = limiterFlexible;\n    this._maxQueueSize = opts.maxQueueSize;\n  }\n  getTokensRemaining() {\n    return this._limiterFlexible.get(this._key).then(rlRes => {\n      return rlRes !== null ? rlRes.remainingPoints : this._limiterFlexible.points;\n    });\n  }\n  removeTokens(tokens) {\n    const _this = this;\n    return new Promise((resolve, reject) => {\n      if (tokens > _this._limiterFlexible.points) {\n        reject(new RateLimiterQueueError(`Requested tokens ${tokens} exceeds maximum ${_this._limiterFlexible.points} tokens per interval`));\n        return;\n      }\n      if (_this._queue.length > 0) {\n        _this._queueRequest.call(_this, resolve, reject, tokens);\n      } else {\n        _this._limiterFlexible.consume(_this._key, tokens).then(res => {\n          resolve(res.remainingPoints);\n        }).catch(rej => {\n          if (rej instanceof Error) {\n            reject(rej);\n          } else {\n            _this._queueRequest.call(_this, resolve, reject, tokens);\n            if (_this._waitTimeout === null) {\n              _this._waitTimeout = setTimeout(_this._processFIFO.bind(_this), rej.msBeforeNext);\n            }\n          }\n        });\n      }\n    });\n  }\n  _queueRequest(resolve, reject, tokens) {\n    const _this = this;\n    if (_this._queue.length < _this._maxQueueSize) {\n      _this._queue.push({\n        resolve,\n        reject,\n        tokens\n      });\n    } else {\n      reject(new RateLimiterQueueError(`Number of requests reached it's maximum ${_this._maxQueueSize}`));\n    }\n  }\n  _processFIFO() {\n    const _this = this;\n    if (_this._waitTimeout !== null) {\n      clearTimeout(_this._waitTimeout);\n      _this._waitTimeout = null;\n    }\n    if (_this._queue.length === 0) {\n      return;\n    }\n    const item = _this._queue.shift();\n    _this._limiterFlexible.consume(_this._key, item.tokens).then(res => {\n      item.resolve(res.remainingPoints);\n      _this._processFIFO.call(_this);\n    }).catch(rej => {\n      if (rej instanceof Error) {\n        item.reject(rej);\n        _this._processFIFO.call(_this);\n      } else {\n        _this._queue.unshift(item);\n        if (_this._waitTimeout === null) {\n          _this._waitTimeout = setTimeout(_this._processFIFO.bind(_this), rej.msBeforeNext);\n        }\n      }\n    });\n  }\n}","map":{"version":3,"names":["RateLimiterQueueError","require","MAX_QUEUE_SIZE","KEY_DEFAULT","module","exports","RateLimiterQueue","constructor","limiterFlexible","opts","maxQueueSize","_queueLimiters","RateLimiterQueueInternal","_limiterFlexible","_maxQueueSize","getTokensRemaining","key","Promise","resolve","points","removeTokens","tokens","_key","_waitTimeout","_queue","get","then","rlRes","remainingPoints","_this","reject","length","_queueRequest","call","consume","res","catch","rej","Error","setTimeout","_processFIFO","bind","msBeforeNext","push","clearTimeout","item","shift","unshift"],"sources":["/Users/yezery/Oasis/OASIS/node_modules/.store/rate-limiter-flexible@2.4.2/node_modules/rate-limiter-flexible/lib/RateLimiterQueue.js"],"sourcesContent":["const RateLimiterQueueError = require('./component/RateLimiterQueueError')\nconst MAX_QUEUE_SIZE = 4294967295;\nconst KEY_DEFAULT = 'limiter';\n\nmodule.exports = class RateLimiterQueue {\n  constructor(limiterFlexible, opts = {\n    maxQueueSize: MAX_QUEUE_SIZE,\n  }) {\n    this._queueLimiters = {\n      KEY_DEFAULT: new RateLimiterQueueInternal(limiterFlexible, opts)\n    };\n    this._limiterFlexible = limiterFlexible;\n    this._maxQueueSize = opts.maxQueueSize\n  }\n\n  getTokensRemaining(key = KEY_DEFAULT) {\n    if (this._queueLimiters[key]) {\n      return this._queueLimiters[key].getTokensRemaining()\n    } else {\n      return Promise.resolve(this._limiterFlexible.points)\n    }\n  }\n\n  removeTokens(tokens, key = KEY_DEFAULT) {\n    if (!this._queueLimiters[key]) {\n      this._queueLimiters[key] = new RateLimiterQueueInternal(\n        this._limiterFlexible, {\n          key,\n          maxQueueSize: this._maxQueueSize,\n        })\n    }\n\n    return this._queueLimiters[key].removeTokens(tokens)\n  }\n};\n\nclass RateLimiterQueueInternal {\n\n  constructor(limiterFlexible, opts = {\n    maxQueueSize: MAX_QUEUE_SIZE,\n    key: KEY_DEFAULT,\n  }) {\n    this._key = opts.key;\n    this._waitTimeout = null;\n    this._queue = [];\n    this._limiterFlexible = limiterFlexible;\n\n    this._maxQueueSize = opts.maxQueueSize\n  }\n\n  getTokensRemaining() {\n    return this._limiterFlexible.get(this._key)\n      .then((rlRes) => {\n        return rlRes !== null ? rlRes.remainingPoints : this._limiterFlexible.points;\n      })\n  }\n\n  removeTokens(tokens) {\n    const _this = this;\n\n    return new Promise((resolve, reject) => {\n      if (tokens > _this._limiterFlexible.points) {\n        reject(new RateLimiterQueueError(`Requested tokens ${tokens} exceeds maximum ${_this._limiterFlexible.points} tokens per interval`));\n        return\n      }\n\n      if (_this._queue.length > 0) {\n        _this._queueRequest.call(_this, resolve, reject, tokens);\n      } else {\n        _this._limiterFlexible.consume(_this._key, tokens)\n          .then((res) => {\n            resolve(res.remainingPoints);\n          })\n          .catch((rej) => {\n            if (rej instanceof Error) {\n              reject(rej);\n            } else {\n              _this._queueRequest.call(_this, resolve, reject, tokens);\n              if (_this._waitTimeout === null) {\n                _this._waitTimeout = setTimeout(_this._processFIFO.bind(_this), rej.msBeforeNext);\n              }\n            }\n          });\n      }\n    })\n  }\n\n  _queueRequest(resolve, reject, tokens) {\n    const _this = this;\n    if (_this._queue.length < _this._maxQueueSize) {\n      _this._queue.push({resolve, reject, tokens});\n    } else {\n      reject(new RateLimiterQueueError(`Number of requests reached it's maximum ${_this._maxQueueSize}`))\n    }\n  }\n\n  _processFIFO() {\n    const _this = this;\n\n    if (_this._waitTimeout !== null) {\n      clearTimeout(_this._waitTimeout);\n      _this._waitTimeout = null;\n    }\n\n    if (_this._queue.length === 0) {\n      return;\n    }\n\n    const item = _this._queue.shift();\n    _this._limiterFlexible.consume(_this._key, item.tokens)\n      .then((res) => {\n        item.resolve(res.remainingPoints);\n        _this._processFIFO.call(_this);\n      })\n      .catch((rej) => {\n        if (rej instanceof Error) {\n          item.reject(rej);\n          _this._processFIFO.call(_this);\n        } else {\n          _this._queue.unshift(item);\n          if (_this._waitTimeout === null) {\n            _this._waitTimeout = setTimeout(_this._processFIFO.bind(_this), rej.msBeforeNext);\n          }\n        }\n      });\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}