{"ast":null,"code":"module.exports = class BlockedKeys {\n  constructor() {\n    this._keys = {}; // {'key': 1526279430331}\n    this._addedKeysAmount = 0;\n  }\n  collectExpired() {\n    const now = Date.now();\n    Object.keys(this._keys).forEach(key => {\n      if (this._keys[key] <= now) {\n        delete this._keys[key];\n      }\n    });\n    this._addedKeysAmount = Object.keys(this._keys).length;\n  }\n\n  /**\n   * Add new blocked key\n   *\n   * @param key String\n   * @param sec Number\n   */\n  add(key, sec) {\n    this.addMs(key, sec * 1000);\n  }\n\n  /**\n   * Add new blocked key for ms\n   *\n   * @param key String\n   * @param ms Number\n   */\n  addMs(key, ms) {\n    this._keys[key] = Date.now() + ms;\n    this._addedKeysAmount++;\n    if (this._addedKeysAmount > 999) {\n      this.collectExpired();\n    }\n  }\n\n  /**\n   * 0 means not blocked\n   *\n   * @param key\n   * @returns {number}\n   */\n  msBeforeExpire(key) {\n    const expire = this._keys[key];\n    if (expire && expire >= Date.now()) {\n      this.collectExpired();\n      const now = Date.now();\n      return expire >= now ? expire - now : 0;\n    }\n    return 0;\n  }\n\n  /**\n   * If key is not given, delete all data in memory\n   * \n   * @param {string|undefined} key\n   */\n  delete(key) {\n    if (key) {\n      delete this._keys[key];\n    } else {\n      Object.keys(this._keys).forEach(key => {\n        delete this._keys[key];\n      });\n    }\n  }\n};","map":{"version":3,"names":["module","exports","BlockedKeys","constructor","_keys","_addedKeysAmount","collectExpired","now","Date","Object","keys","forEach","key","length","add","sec","addMs","ms","msBeforeExpire","expire","delete"],"sources":["/Users/yezery/Oasis/OASIS/node_modules/.store/rate-limiter-flexible@2.4.2/node_modules/rate-limiter-flexible/lib/component/BlockedKeys/BlockedKeys.js"],"sourcesContent":["module.exports = class BlockedKeys {\n  constructor() {\n    this._keys = {}; // {'key': 1526279430331}\n    this._addedKeysAmount = 0;\n  }\n\n  collectExpired() {\n    const now = Date.now();\n\n    Object.keys(this._keys).forEach((key) => {\n      if (this._keys[key] <= now) {\n        delete this._keys[key];\n      }\n    });\n\n    this._addedKeysAmount = Object.keys(this._keys).length;\n  }\n\n  /**\n   * Add new blocked key\n   *\n   * @param key String\n   * @param sec Number\n   */\n  add(key, sec) {\n    this.addMs(key, sec * 1000);\n  }\n\n  /**\n   * Add new blocked key for ms\n   *\n   * @param key String\n   * @param ms Number\n   */\n  addMs(key, ms) {\n    this._keys[key] = Date.now() + ms;\n    this._addedKeysAmount++;\n    if (this._addedKeysAmount > 999) {\n      this.collectExpired();\n    }\n  }\n\n  /**\n   * 0 means not blocked\n   *\n   * @param key\n   * @returns {number}\n   */\n  msBeforeExpire(key) {\n    const expire = this._keys[key];\n\n    if (expire && expire >= Date.now()) {\n      this.collectExpired();\n      const now = Date.now();\n      return expire >= now ? expire - now : 0;\n    }\n\n    return 0;\n  }\n\n  /**\n   * If key is not given, delete all data in memory\n   * \n   * @param {string|undefined} key\n   */\n  delete(key) {\n    if (key) {\n      delete this._keys[key];\n    } else {\n      Object.keys(this._keys).forEach((key) => {\n        delete this._keys[key];\n      });\n    }\n  }\n};\n"],"mappings":"AAAAA,MAAM,CAACC,OAAO,GAAG,MAAMC,WAAW,CAAC;EACjCC,WAAWA,CAAA,EAAG;IACZ,IAAI,CAACC,KAAK,GAAG,CAAC,CAAC,CAAC,CAAC;IACjB,IAAI,CAACC,gBAAgB,GAAG,CAAC;EAC3B;EAEAC,cAAcA,CAAA,EAAG;IACf,MAAMC,GAAG,GAAGC,IAAI,CAACD,GAAG,CAAC,CAAC;IAEtBE,MAAM,CAACC,IAAI,CAAC,IAAI,CAACN,KAAK,CAAC,CAACO,OAAO,CAAEC,GAAG,IAAK;MACvC,IAAI,IAAI,CAACR,KAAK,CAACQ,GAAG,CAAC,IAAIL,GAAG,EAAE;QAC1B,OAAO,IAAI,CAACH,KAAK,CAACQ,GAAG,CAAC;MACxB;IACF,CAAC,CAAC;IAEF,IAAI,CAACP,gBAAgB,GAAGI,MAAM,CAACC,IAAI,CAAC,IAAI,CAACN,KAAK,CAAC,CAACS,MAAM;EACxD;;EAEA;AACF;AACA;AACA;AACA;AACA;EACEC,GAAGA,CAACF,GAAG,EAAEG,GAAG,EAAE;IACZ,IAAI,CAACC,KAAK,CAACJ,GAAG,EAAEG,GAAG,GAAG,IAAI,CAAC;EAC7B;;EAEA;AACF;AACA;AACA;AACA;AACA;EACEC,KAAKA,CAACJ,GAAG,EAAEK,EAAE,EAAE;IACb,IAAI,CAACb,KAAK,CAACQ,GAAG,CAAC,GAAGJ,IAAI,CAACD,GAAG,CAAC,CAAC,GAAGU,EAAE;IACjC,IAAI,CAACZ,gBAAgB,EAAE;IACvB,IAAI,IAAI,CAACA,gBAAgB,GAAG,GAAG,EAAE;MAC/B,IAAI,CAACC,cAAc,CAAC,CAAC;IACvB;EACF;;EAEA;AACF;AACA;AACA;AACA;AACA;EACEY,cAAcA,CAACN,GAAG,EAAE;IAClB,MAAMO,MAAM,GAAG,IAAI,CAACf,KAAK,CAACQ,GAAG,CAAC;IAE9B,IAAIO,MAAM,IAAIA,MAAM,IAAIX,IAAI,CAACD,GAAG,CAAC,CAAC,EAAE;MAClC,IAAI,CAACD,cAAc,CAAC,CAAC;MACrB,MAAMC,GAAG,GAAGC,IAAI,CAACD,GAAG,CAAC,CAAC;MACtB,OAAOY,MAAM,IAAIZ,GAAG,GAAGY,MAAM,GAAGZ,GAAG,GAAG,CAAC;IACzC;IAEA,OAAO,CAAC;EACV;;EAEA;AACF;AACA;AACA;AACA;EACEa,MAAMA,CAACR,GAAG,EAAE;IACV,IAAIA,GAAG,EAAE;MACP,OAAO,IAAI,CAACR,KAAK,CAACQ,GAAG,CAAC;IACxB,CAAC,MAAM;MACLH,MAAM,CAACC,IAAI,CAAC,IAAI,CAACN,KAAK,CAAC,CAACO,OAAO,CAAEC,GAAG,IAAK;QACvC,OAAO,IAAI,CAACR,KAAK,CAACQ,GAAG,CAAC;MACxB,CAAC,CAAC;IACJ;EACF;AACF,CAAC"},"metadata":{},"sourceType":"script","externalDependencies":[]}