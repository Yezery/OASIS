{"ast":null,"code":"const RateLimiterRes = require('./RateLimiterRes');\nmodule.exports = class RLWrapperBlackAndWhite {\n  constructor(opts = {}) {\n    this.limiter = opts.limiter;\n    this.blackList = opts.blackList;\n    this.whiteList = opts.whiteList;\n    this.isBlackListed = opts.isBlackListed;\n    this.isWhiteListed = opts.isWhiteListed;\n    this.runActionAnyway = opts.runActionAnyway;\n  }\n  get limiter() {\n    return this._limiter;\n  }\n  set limiter(value) {\n    if (typeof value === 'undefined') {\n      throw new Error('limiter is not set');\n    }\n    this._limiter = value;\n  }\n  get runActionAnyway() {\n    return this._runActionAnyway;\n  }\n  set runActionAnyway(value) {\n    this._runActionAnyway = typeof value === 'undefined' ? false : value;\n  }\n  get blackList() {\n    return this._blackList;\n  }\n  set blackList(value) {\n    this._blackList = Array.isArray(value) ? value : [];\n  }\n  get isBlackListed() {\n    return this._isBlackListed;\n  }\n  set isBlackListed(func) {\n    if (typeof func === 'undefined') {\n      func = () => false;\n    }\n    if (typeof func !== 'function') {\n      throw new Error('isBlackListed must be function');\n    }\n    this._isBlackListed = func;\n  }\n  get whiteList() {\n    return this._whiteList;\n  }\n  set whiteList(value) {\n    this._whiteList = Array.isArray(value) ? value : [];\n  }\n  get isWhiteListed() {\n    return this._isWhiteListed;\n  }\n  set isWhiteListed(func) {\n    if (typeof func === 'undefined') {\n      func = () => false;\n    }\n    if (typeof func !== 'function') {\n      throw new Error('isWhiteListed must be function');\n    }\n    this._isWhiteListed = func;\n  }\n  isBlackListedSomewhere(key) {\n    return this.blackList.indexOf(key) >= 0 || this.isBlackListed(key);\n  }\n  isWhiteListedSomewhere(key) {\n    return this.whiteList.indexOf(key) >= 0 || this.isWhiteListed(key);\n  }\n  getBlackRes() {\n    return new RateLimiterRes(0, Number.MAX_SAFE_INTEGER, 0, false);\n  }\n  getWhiteRes() {\n    return new RateLimiterRes(Number.MAX_SAFE_INTEGER, 0, 0, false);\n  }\n  rejectBlack() {\n    return Promise.reject(this.getBlackRes());\n  }\n  resolveBlack() {\n    return Promise.resolve(this.getBlackRes());\n  }\n  resolveWhite() {\n    return Promise.resolve(this.getWhiteRes());\n  }\n  consume(key, pointsToConsume = 1) {\n    let res;\n    if (this.isWhiteListedSomewhere(key)) {\n      res = this.resolveWhite();\n    } else if (this.isBlackListedSomewhere(key)) {\n      res = this.rejectBlack();\n    }\n    if (typeof res === 'undefined') {\n      return this.limiter.consume(key, pointsToConsume);\n    }\n    if (this.runActionAnyway) {\n      this.limiter.consume(key, pointsToConsume).catch(() => {});\n    }\n    return res;\n  }\n  block(key, secDuration) {\n    let res;\n    if (this.isWhiteListedSomewhere(key)) {\n      res = this.resolveWhite();\n    } else if (this.isBlackListedSomewhere(key)) {\n      res = this.resolveBlack();\n    }\n    if (typeof res === 'undefined') {\n      return this.limiter.block(key, secDuration);\n    }\n    if (this.runActionAnyway) {\n      this.limiter.block(key, secDuration).catch(() => {});\n    }\n    return res;\n  }\n  penalty(key, points) {\n    let res;\n    if (this.isWhiteListedSomewhere(key)) {\n      res = this.resolveWhite();\n    } else if (this.isBlackListedSomewhere(key)) {\n      res = this.resolveBlack();\n    }\n    if (typeof res === 'undefined') {\n      return this.limiter.penalty(key, points);\n    }\n    if (this.runActionAnyway) {\n      this.limiter.penalty(key, points).catch(() => {});\n    }\n    return res;\n  }\n  reward(key, points) {\n    let res;\n    if (this.isWhiteListedSomewhere(key)) {\n      res = this.resolveWhite();\n    } else if (this.isBlackListedSomewhere(key)) {\n      res = this.resolveBlack();\n    }\n    if (typeof res === 'undefined') {\n      return this.limiter.reward(key, points);\n    }\n    if (this.runActionAnyway) {\n      this.limiter.reward(key, points).catch(() => {});\n    }\n    return res;\n  }\n  get(key) {\n    let res;\n    if (this.isWhiteListedSomewhere(key)) {\n      res = this.resolveWhite();\n    } else if (this.isBlackListedSomewhere(key)) {\n      res = this.resolveBlack();\n    }\n    if (typeof res === 'undefined' || this.runActionAnyway) {\n      return this.limiter.get(key);\n    }\n    return res;\n  }\n  delete(key) {\n    return this.limiter.delete(key);\n  }\n};","map":{"version":3,"names":["RateLimiterRes","require","module","exports","RLWrapperBlackAndWhite","constructor","opts","limiter","blackList","whiteList","isBlackListed","isWhiteListed","runActionAnyway","_limiter","value","Error","_runActionAnyway","_blackList","Array","isArray","_isBlackListed","func","_whiteList","_isWhiteListed","isBlackListedSomewhere","key","indexOf","isWhiteListedSomewhere","getBlackRes","Number","MAX_SAFE_INTEGER","getWhiteRes","rejectBlack","Promise","reject","resolveBlack","resolve","resolveWhite","consume","pointsToConsume","res","catch","block","secDuration","penalty","points","reward","get","delete"],"sources":["/Users/yezery/Oasis/OASIS/node_modules/.store/rate-limiter-flexible@2.4.2/node_modules/rate-limiter-flexible/lib/RLWrapperBlackAndWhite.js"],"sourcesContent":["const RateLimiterRes = require('./RateLimiterRes');\n\nmodule.exports = class RLWrapperBlackAndWhite {\n  constructor(opts = {}) {\n    this.limiter = opts.limiter;\n    this.blackList = opts.blackList;\n    this.whiteList = opts.whiteList;\n    this.isBlackListed = opts.isBlackListed;\n    this.isWhiteListed = opts.isWhiteListed;\n    this.runActionAnyway = opts.runActionAnyway;\n  }\n\n  get limiter() {\n    return this._limiter;\n  }\n\n  set limiter(value) {\n    if (typeof value === 'undefined') {\n      throw new Error('limiter is not set');\n    }\n\n    this._limiter = value;\n  }\n\n  get runActionAnyway() {\n    return this._runActionAnyway;\n  }\n\n  set runActionAnyway(value) {\n    this._runActionAnyway = typeof value === 'undefined' ? false : value;\n  }\n\n  get blackList() {\n    return this._blackList;\n  }\n\n  set blackList(value) {\n    this._blackList = Array.isArray(value) ? value : [];\n  }\n\n  get isBlackListed() {\n    return this._isBlackListed;\n  }\n\n  set isBlackListed(func) {\n    if (typeof func === 'undefined') {\n      func = () => false;\n    }\n    if (typeof func !== 'function') {\n      throw new Error('isBlackListed must be function');\n    }\n    this._isBlackListed = func;\n  }\n\n  get whiteList() {\n    return this._whiteList;\n  }\n\n  set whiteList(value) {\n    this._whiteList = Array.isArray(value) ? value : [];\n  }\n\n  get isWhiteListed() {\n    return this._isWhiteListed;\n  }\n\n  set isWhiteListed(func) {\n    if (typeof func === 'undefined') {\n      func = () => false;\n    }\n    if (typeof func !== 'function') {\n      throw new Error('isWhiteListed must be function');\n    }\n    this._isWhiteListed = func;\n  }\n\n  isBlackListedSomewhere(key) {\n    return this.blackList.indexOf(key) >= 0 || this.isBlackListed(key);\n  }\n\n  isWhiteListedSomewhere(key) {\n    return this.whiteList.indexOf(key) >= 0 || this.isWhiteListed(key);\n  }\n\n  getBlackRes() {\n    return new RateLimiterRes(0, Number.MAX_SAFE_INTEGER, 0, false);\n  }\n\n  getWhiteRes() {\n    return new RateLimiterRes(Number.MAX_SAFE_INTEGER, 0, 0, false);\n  }\n\n  rejectBlack() {\n    return Promise.reject(this.getBlackRes());\n  }\n\n  resolveBlack() {\n    return Promise.resolve(this.getBlackRes());\n  }\n\n  resolveWhite() {\n    return Promise.resolve(this.getWhiteRes());\n  }\n\n  consume(key, pointsToConsume = 1) {\n    let res;\n    if (this.isWhiteListedSomewhere(key)) {\n      res = this.resolveWhite();\n    } else if (this.isBlackListedSomewhere(key)) {\n      res = this.rejectBlack();\n    }\n\n    if (typeof res === 'undefined') {\n      return this.limiter.consume(key, pointsToConsume);\n    }\n\n    if (this.runActionAnyway) {\n      this.limiter.consume(key, pointsToConsume).catch(() => {});\n    }\n    return res;\n  }\n\n  block(key, secDuration) {\n    let res;\n    if (this.isWhiteListedSomewhere(key)) {\n      res = this.resolveWhite();\n    } else if (this.isBlackListedSomewhere(key)) {\n      res = this.resolveBlack();\n    }\n\n    if (typeof res === 'undefined') {\n      return this.limiter.block(key, secDuration);\n    }\n\n    if (this.runActionAnyway) {\n      this.limiter.block(key, secDuration).catch(() => {});\n    }\n    return res;\n  }\n\n  penalty(key, points) {\n    let res;\n    if (this.isWhiteListedSomewhere(key)) {\n      res = this.resolveWhite();\n    } else if (this.isBlackListedSomewhere(key)) {\n      res = this.resolveBlack();\n    }\n\n    if (typeof res === 'undefined') {\n      return this.limiter.penalty(key, points);\n    }\n\n    if (this.runActionAnyway) {\n      this.limiter.penalty(key, points).catch(() => {});\n    }\n    return res;\n  }\n\n  reward(key, points) {\n    let res;\n    if (this.isWhiteListedSomewhere(key)) {\n      res = this.resolveWhite();\n    } else if (this.isBlackListedSomewhere(key)) {\n      res = this.resolveBlack();\n    }\n\n    if (typeof res === 'undefined') {\n      return this.limiter.reward(key, points);\n    }\n\n    if (this.runActionAnyway) {\n      this.limiter.reward(key, points).catch(() => {});\n    }\n    return res;\n  }\n\n  get(key) {\n    let res;\n    if (this.isWhiteListedSomewhere(key)) {\n      res = this.resolveWhite();\n    } else if (this.isBlackListedSomewhere(key)) {\n      res = this.resolveBlack();\n    }\n\n    if (typeof res === 'undefined' || this.runActionAnyway) {\n      return this.limiter.get(key);\n    }\n\n    return res;\n  }\n\n  delete(key) {\n    return this.limiter.delete(key);\n  }\n};\n"],"mappings":"AAAA,MAAMA,cAAc,GAAGC,OAAO,CAAC,kBAAkB,CAAC;AAElDC,MAAM,CAACC,OAAO,GAAG,MAAMC,sBAAsB,CAAC;EAC5CC,WAAWA,CAACC,IAAI,GAAG,CAAC,CAAC,EAAE;IACrB,IAAI,CAACC,OAAO,GAAGD,IAAI,CAACC,OAAO;IAC3B,IAAI,CAACC,SAAS,GAAGF,IAAI,CAACE,SAAS;IAC/B,IAAI,CAACC,SAAS,GAAGH,IAAI,CAACG,SAAS;IAC/B,IAAI,CAACC,aAAa,GAAGJ,IAAI,CAACI,aAAa;IACvC,IAAI,CAACC,aAAa,GAAGL,IAAI,CAACK,aAAa;IACvC,IAAI,CAACC,eAAe,GAAGN,IAAI,CAACM,eAAe;EAC7C;EAEA,IAAIL,OAAOA,CAAA,EAAG;IACZ,OAAO,IAAI,CAACM,QAAQ;EACtB;EAEA,IAAIN,OAAOA,CAACO,KAAK,EAAE;IACjB,IAAI,OAAOA,KAAK,KAAK,WAAW,EAAE;MAChC,MAAM,IAAIC,KAAK,CAAC,oBAAoB,CAAC;IACvC;IAEA,IAAI,CAACF,QAAQ,GAAGC,KAAK;EACvB;EAEA,IAAIF,eAAeA,CAAA,EAAG;IACpB,OAAO,IAAI,CAACI,gBAAgB;EAC9B;EAEA,IAAIJ,eAAeA,CAACE,KAAK,EAAE;IACzB,IAAI,CAACE,gBAAgB,GAAG,OAAOF,KAAK,KAAK,WAAW,GAAG,KAAK,GAAGA,KAAK;EACtE;EAEA,IAAIN,SAASA,CAAA,EAAG;IACd,OAAO,IAAI,CAACS,UAAU;EACxB;EAEA,IAAIT,SAASA,CAACM,KAAK,EAAE;IACnB,IAAI,CAACG,UAAU,GAAGC,KAAK,CAACC,OAAO,CAACL,KAAK,CAAC,GAAGA,KAAK,GAAG,EAAE;EACrD;EAEA,IAAIJ,aAAaA,CAAA,EAAG;IAClB,OAAO,IAAI,CAACU,cAAc;EAC5B;EAEA,IAAIV,aAAaA,CAACW,IAAI,EAAE;IACtB,IAAI,OAAOA,IAAI,KAAK,WAAW,EAAE;MAC/BA,IAAI,GAAGA,CAAA,KAAM,KAAK;IACpB;IACA,IAAI,OAAOA,IAAI,KAAK,UAAU,EAAE;MAC9B,MAAM,IAAIN,KAAK,CAAC,gCAAgC,CAAC;IACnD;IACA,IAAI,CAACK,cAAc,GAAGC,IAAI;EAC5B;EAEA,IAAIZ,SAASA,CAAA,EAAG;IACd,OAAO,IAAI,CAACa,UAAU;EACxB;EAEA,IAAIb,SAASA,CAACK,KAAK,EAAE;IACnB,IAAI,CAACQ,UAAU,GAAGJ,KAAK,CAACC,OAAO,CAACL,KAAK,CAAC,GAAGA,KAAK,GAAG,EAAE;EACrD;EAEA,IAAIH,aAAaA,CAAA,EAAG;IAClB,OAAO,IAAI,CAACY,cAAc;EAC5B;EAEA,IAAIZ,aAAaA,CAACU,IAAI,EAAE;IACtB,IAAI,OAAOA,IAAI,KAAK,WAAW,EAAE;MAC/BA,IAAI,GAAGA,CAAA,KAAM,KAAK;IACpB;IACA,IAAI,OAAOA,IAAI,KAAK,UAAU,EAAE;MAC9B,MAAM,IAAIN,KAAK,CAAC,gCAAgC,CAAC;IACnD;IACA,IAAI,CAACQ,cAAc,GAAGF,IAAI;EAC5B;EAEAG,sBAAsBA,CAACC,GAAG,EAAE;IAC1B,OAAO,IAAI,CAACjB,SAAS,CAACkB,OAAO,CAACD,GAAG,CAAC,IAAI,CAAC,IAAI,IAAI,CAACf,aAAa,CAACe,GAAG,CAAC;EACpE;EAEAE,sBAAsBA,CAACF,GAAG,EAAE;IAC1B,OAAO,IAAI,CAAChB,SAAS,CAACiB,OAAO,CAACD,GAAG,CAAC,IAAI,CAAC,IAAI,IAAI,CAACd,aAAa,CAACc,GAAG,CAAC;EACpE;EAEAG,WAAWA,CAAA,EAAG;IACZ,OAAO,IAAI5B,cAAc,CAAC,CAAC,EAAE6B,MAAM,CAACC,gBAAgB,EAAE,CAAC,EAAE,KAAK,CAAC;EACjE;EAEAC,WAAWA,CAAA,EAAG;IACZ,OAAO,IAAI/B,cAAc,CAAC6B,MAAM,CAACC,gBAAgB,EAAE,CAAC,EAAE,CAAC,EAAE,KAAK,CAAC;EACjE;EAEAE,WAAWA,CAAA,EAAG;IACZ,OAAOC,OAAO,CAACC,MAAM,CAAC,IAAI,CAACN,WAAW,CAAC,CAAC,CAAC;EAC3C;EAEAO,YAAYA,CAAA,EAAG;IACb,OAAOF,OAAO,CAACG,OAAO,CAAC,IAAI,CAACR,WAAW,CAAC,CAAC,CAAC;EAC5C;EAEAS,YAAYA,CAAA,EAAG;IACb,OAAOJ,OAAO,CAACG,OAAO,CAAC,IAAI,CAACL,WAAW,CAAC,CAAC,CAAC;EAC5C;EAEAO,OAAOA,CAACb,GAAG,EAAEc,eAAe,GAAG,CAAC,EAAE;IAChC,IAAIC,GAAG;IACP,IAAI,IAAI,CAACb,sBAAsB,CAACF,GAAG,CAAC,EAAE;MACpCe,GAAG,GAAG,IAAI,CAACH,YAAY,CAAC,CAAC;IAC3B,CAAC,MAAM,IAAI,IAAI,CAACb,sBAAsB,CAACC,GAAG,CAAC,EAAE;MAC3Ce,GAAG,GAAG,IAAI,CAACR,WAAW,CAAC,CAAC;IAC1B;IAEA,IAAI,OAAOQ,GAAG,KAAK,WAAW,EAAE;MAC9B,OAAO,IAAI,CAACjC,OAAO,CAAC+B,OAAO,CAACb,GAAG,EAAEc,eAAe,CAAC;IACnD;IAEA,IAAI,IAAI,CAAC3B,eAAe,EAAE;MACxB,IAAI,CAACL,OAAO,CAAC+B,OAAO,CAACb,GAAG,EAAEc,eAAe,CAAC,CAACE,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC;IAC5D;IACA,OAAOD,GAAG;EACZ;EAEAE,KAAKA,CAACjB,GAAG,EAAEkB,WAAW,EAAE;IACtB,IAAIH,GAAG;IACP,IAAI,IAAI,CAACb,sBAAsB,CAACF,GAAG,CAAC,EAAE;MACpCe,GAAG,GAAG,IAAI,CAACH,YAAY,CAAC,CAAC;IAC3B,CAAC,MAAM,IAAI,IAAI,CAACb,sBAAsB,CAACC,GAAG,CAAC,EAAE;MAC3Ce,GAAG,GAAG,IAAI,CAACL,YAAY,CAAC,CAAC;IAC3B;IAEA,IAAI,OAAOK,GAAG,KAAK,WAAW,EAAE;MAC9B,OAAO,IAAI,CAACjC,OAAO,CAACmC,KAAK,CAACjB,GAAG,EAAEkB,WAAW,CAAC;IAC7C;IAEA,IAAI,IAAI,CAAC/B,eAAe,EAAE;MACxB,IAAI,CAACL,OAAO,CAACmC,KAAK,CAACjB,GAAG,EAAEkB,WAAW,CAAC,CAACF,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC;IACtD;IACA,OAAOD,GAAG;EACZ;EAEAI,OAAOA,CAACnB,GAAG,EAAEoB,MAAM,EAAE;IACnB,IAAIL,GAAG;IACP,IAAI,IAAI,CAACb,sBAAsB,CAACF,GAAG,CAAC,EAAE;MACpCe,GAAG,GAAG,IAAI,CAACH,YAAY,CAAC,CAAC;IAC3B,CAAC,MAAM,IAAI,IAAI,CAACb,sBAAsB,CAACC,GAAG,CAAC,EAAE;MAC3Ce,GAAG,GAAG,IAAI,CAACL,YAAY,CAAC,CAAC;IAC3B;IAEA,IAAI,OAAOK,GAAG,KAAK,WAAW,EAAE;MAC9B,OAAO,IAAI,CAACjC,OAAO,CAACqC,OAAO,CAACnB,GAAG,EAAEoB,MAAM,CAAC;IAC1C;IAEA,IAAI,IAAI,CAACjC,eAAe,EAAE;MACxB,IAAI,CAACL,OAAO,CAACqC,OAAO,CAACnB,GAAG,EAAEoB,MAAM,CAAC,CAACJ,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC;IACnD;IACA,OAAOD,GAAG;EACZ;EAEAM,MAAMA,CAACrB,GAAG,EAAEoB,MAAM,EAAE;IAClB,IAAIL,GAAG;IACP,IAAI,IAAI,CAACb,sBAAsB,CAACF,GAAG,CAAC,EAAE;MACpCe,GAAG,GAAG,IAAI,CAACH,YAAY,CAAC,CAAC;IAC3B,CAAC,MAAM,IAAI,IAAI,CAACb,sBAAsB,CAACC,GAAG,CAAC,EAAE;MAC3Ce,GAAG,GAAG,IAAI,CAACL,YAAY,CAAC,CAAC;IAC3B;IAEA,IAAI,OAAOK,GAAG,KAAK,WAAW,EAAE;MAC9B,OAAO,IAAI,CAACjC,OAAO,CAACuC,MAAM,CAACrB,GAAG,EAAEoB,MAAM,CAAC;IACzC;IAEA,IAAI,IAAI,CAACjC,eAAe,EAAE;MACxB,IAAI,CAACL,OAAO,CAACuC,MAAM,CAACrB,GAAG,EAAEoB,MAAM,CAAC,CAACJ,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC;IAClD;IACA,OAAOD,GAAG;EACZ;EAEAO,GAAGA,CAACtB,GAAG,EAAE;IACP,IAAIe,GAAG;IACP,IAAI,IAAI,CAACb,sBAAsB,CAACF,GAAG,CAAC,EAAE;MACpCe,GAAG,GAAG,IAAI,CAACH,YAAY,CAAC,CAAC;IAC3B,CAAC,MAAM,IAAI,IAAI,CAACb,sBAAsB,CAACC,GAAG,CAAC,EAAE;MAC3Ce,GAAG,GAAG,IAAI,CAACL,YAAY,CAAC,CAAC;IAC3B;IAEA,IAAI,OAAOK,GAAG,KAAK,WAAW,IAAI,IAAI,CAAC5B,eAAe,EAAE;MACtD,OAAO,IAAI,CAACL,OAAO,CAACwC,GAAG,CAACtB,GAAG,CAAC;IAC9B;IAEA,OAAOe,GAAG;EACZ;EAEAQ,MAAMA,CAACvB,GAAG,EAAE;IACV,OAAO,IAAI,CAAClB,OAAO,CAACyC,MAAM,CAACvB,GAAG,CAAC;EACjC;AACF,CAAC"},"metadata":{},"sourceType":"script","externalDependencies":[]}