{"ast":null,"code":"import DirSharded from './dir-sharded.js';\nimport DirFlat from './dir-flat.js';\n\n/**\n * @typedef {import('./dir').default} Dir\n * @typedef {import('./types').ImporterOptions} ImporterOptions\n */\n\n/**\n * @param {Dir | null} child\n * @param {Dir} dir\n * @param {number} threshold\n * @param {ImporterOptions} options\n * @returns {Promise<DirSharded>}\n */\nasync function flatToShard(child, dir, threshold, options) {\n  let newDir = dir;\n  if (dir instanceof DirFlat && dir.directChildrenCount() >= threshold) {\n    newDir = await convertToShard(dir, options);\n  }\n  const parent = newDir.parent;\n  if (parent) {\n    if (newDir !== dir) {\n      if (child) {\n        child.parent = newDir;\n      }\n      if (!newDir.parentKey) {\n        throw new Error('No parent key found');\n      }\n      await parent.put(newDir.parentKey, newDir);\n    }\n    return flatToShard(newDir, parent, threshold, options);\n  }\n\n  // @ts-ignore\n  return newDir;\n}\n\n/**\n * @param {DirFlat} oldDir\n * @param {ImporterOptions} options\n */\nasync function convertToShard(oldDir, options) {\n  const newDir = new DirSharded({\n    root: oldDir.root,\n    dir: true,\n    parent: oldDir.parent,\n    parentKey: oldDir.parentKey,\n    path: oldDir.path,\n    dirty: oldDir.dirty,\n    flat: false,\n    mtime: oldDir.mtime,\n    mode: oldDir.mode\n  }, options);\n  for await (const {\n    key,\n    child\n  } of oldDir.eachChildSeries()) {\n    await newDir.put(key, child);\n  }\n  return newDir;\n}\nexport default flatToShard;","map":{"version":3,"names":["DirSharded","DirFlat","flatToShard","child","dir","threshold","options","newDir","directChildrenCount","convertToShard","parent","parentKey","Error","put","oldDir","root","path","dirty","flat","mtime","mode","key","eachChildSeries"],"sources":["/Users/yezery/Oasis/OASIS/node_modules/.store/ipfs-unixfs-importer@12.0.1/node_modules/ipfs-unixfs-importer/src/flat-to-shard.js"],"sourcesContent":["import DirSharded from './dir-sharded.js'\nimport DirFlat from './dir-flat.js'\n\n/**\n * @typedef {import('./dir').default} Dir\n * @typedef {import('./types').ImporterOptions} ImporterOptions\n */\n\n/**\n * @param {Dir | null} child\n * @param {Dir} dir\n * @param {number} threshold\n * @param {ImporterOptions} options\n * @returns {Promise<DirSharded>}\n */\nasync function flatToShard (child, dir, threshold, options) {\n  let newDir = dir\n\n  if (dir instanceof DirFlat && dir.directChildrenCount() >= threshold) {\n    newDir = await convertToShard(dir, options)\n  }\n\n  const parent = newDir.parent\n\n  if (parent) {\n    if (newDir !== dir) {\n      if (child) {\n        child.parent = newDir\n      }\n\n      if (!newDir.parentKey) {\n        throw new Error('No parent key found')\n      }\n\n      await parent.put(newDir.parentKey, newDir)\n    }\n\n    return flatToShard(newDir, parent, threshold, options)\n  }\n\n  // @ts-ignore\n  return newDir\n}\n\n/**\n * @param {DirFlat} oldDir\n * @param {ImporterOptions} options\n */\nasync function convertToShard (oldDir, options) {\n  const newDir = new DirSharded({\n    root: oldDir.root,\n    dir: true,\n    parent: oldDir.parent,\n    parentKey: oldDir.parentKey,\n    path: oldDir.path,\n    dirty: oldDir.dirty,\n    flat: false,\n    mtime: oldDir.mtime,\n    mode: oldDir.mode\n  }, options)\n\n  for await (const { key, child } of oldDir.eachChildSeries()) {\n    await newDir.put(key, child)\n  }\n\n  return newDir\n}\n\nexport default flatToShard\n"],"mappings":"AAAA,OAAOA,UAAU,MAAM,kBAAkB;AACzC,OAAOC,OAAO,MAAM,eAAe;;AAEnC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAeC,WAAWA,CAAEC,KAAK,EAAEC,GAAG,EAAEC,SAAS,EAAEC,OAAO,EAAE;EAC1D,IAAIC,MAAM,GAAGH,GAAG;EAEhB,IAAIA,GAAG,YAAYH,OAAO,IAAIG,GAAG,CAACI,mBAAmB,CAAC,CAAC,IAAIH,SAAS,EAAE;IACpEE,MAAM,GAAG,MAAME,cAAc,CAACL,GAAG,EAAEE,OAAO,CAAC;EAC7C;EAEA,MAAMI,MAAM,GAAGH,MAAM,CAACG,MAAM;EAE5B,IAAIA,MAAM,EAAE;IACV,IAAIH,MAAM,KAAKH,GAAG,EAAE;MAClB,IAAID,KAAK,EAAE;QACTA,KAAK,CAACO,MAAM,GAAGH,MAAM;MACvB;MAEA,IAAI,CAACA,MAAM,CAACI,SAAS,EAAE;QACrB,MAAM,IAAIC,KAAK,CAAC,qBAAqB,CAAC;MACxC;MAEA,MAAMF,MAAM,CAACG,GAAG,CAACN,MAAM,CAACI,SAAS,EAAEJ,MAAM,CAAC;IAC5C;IAEA,OAAOL,WAAW,CAACK,MAAM,EAAEG,MAAM,EAAEL,SAAS,EAAEC,OAAO,CAAC;EACxD;;EAEA;EACA,OAAOC,MAAM;AACf;;AAEA;AACA;AACA;AACA;AACA,eAAeE,cAAcA,CAAEK,MAAM,EAAER,OAAO,EAAE;EAC9C,MAAMC,MAAM,GAAG,IAAIP,UAAU,CAAC;IAC5Be,IAAI,EAAED,MAAM,CAACC,IAAI;IACjBX,GAAG,EAAE,IAAI;IACTM,MAAM,EAAEI,MAAM,CAACJ,MAAM;IACrBC,SAAS,EAAEG,MAAM,CAACH,SAAS;IAC3BK,IAAI,EAAEF,MAAM,CAACE,IAAI;IACjBC,KAAK,EAAEH,MAAM,CAACG,KAAK;IACnBC,IAAI,EAAE,KAAK;IACXC,KAAK,EAAEL,MAAM,CAACK,KAAK;IACnBC,IAAI,EAAEN,MAAM,CAACM;EACf,CAAC,EAAEd,OAAO,CAAC;EAEX,WAAW,MAAM;IAAEe,GAAG;IAAElB;EAAM,CAAC,IAAIW,MAAM,CAACQ,eAAe,CAAC,CAAC,EAAE;IAC3D,MAAMf,MAAM,CAACM,GAAG,CAACQ,GAAG,EAAElB,KAAK,CAAC;EAC9B;EAEA,OAAOI,MAAM;AACf;AAEA,eAAeL,WAAW"},"metadata":{},"sourceType":"module","externalDependencies":[]}