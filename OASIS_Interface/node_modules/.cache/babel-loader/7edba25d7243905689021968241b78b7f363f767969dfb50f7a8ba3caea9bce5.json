{"ast":null,"code":"import _defineProperty from \"/Users/yezery/Oasis/OASIS/node_modules/.store/@babel+runtime@7.22.15/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport \"core-js/modules/es.array.push.js\";\n// ported from https://www.npmjs.com/package/fast-fifo\nclass FixedFIFO {\n  constructor(hwm) {\n    _defineProperty(this, \"buffer\", void 0);\n    _defineProperty(this, \"mask\", void 0);\n    _defineProperty(this, \"top\", void 0);\n    _defineProperty(this, \"btm\", void 0);\n    _defineProperty(this, \"next\", void 0);\n    if (!(hwm > 0) || (hwm - 1 & hwm) !== 0) {\n      throw new Error('Max size for a FixedFIFO should be a power of two');\n    }\n    this.buffer = new Array(hwm);\n    this.mask = hwm - 1;\n    this.top = 0;\n    this.btm = 0;\n    this.next = null;\n  }\n  push(data) {\n    if (this.buffer[this.top] !== undefined) {\n      return false;\n    }\n    this.buffer[this.top] = data;\n    this.top = this.top + 1 & this.mask;\n    return true;\n  }\n  shift() {\n    const last = this.buffer[this.btm];\n    if (last === undefined) {\n      return undefined;\n    }\n    this.buffer[this.btm] = undefined;\n    this.btm = this.btm + 1 & this.mask;\n    return last;\n  }\n  isEmpty() {\n    return this.buffer[this.btm] === undefined;\n  }\n}\nexport class FIFO {\n  constructor(options = {}) {\n    _defineProperty(this, \"size\", void 0);\n    _defineProperty(this, \"hwm\", void 0);\n    _defineProperty(this, \"head\", void 0);\n    _defineProperty(this, \"tail\", void 0);\n    this.hwm = options.splitLimit ?? 16;\n    this.head = new FixedFIFO(this.hwm);\n    this.tail = this.head;\n    this.size = 0;\n  }\n  calculateSize(obj) {\n    if (obj?.byteLength != null) {\n      return obj.byteLength;\n    }\n    return 1;\n  }\n  push(val) {\n    if (val?.value != null) {\n      this.size += this.calculateSize(val.value);\n    }\n    if (!this.head.push(val)) {\n      const prev = this.head;\n      this.head = prev.next = new FixedFIFO(2 * this.head.buffer.length);\n      this.head.push(val);\n    }\n  }\n  shift() {\n    let val = this.tail.shift();\n    if (val === undefined && this.tail.next != null) {\n      const next = this.tail.next;\n      this.tail.next = null;\n      this.tail = next;\n      val = this.tail.shift();\n    }\n    if (val?.value != null) {\n      this.size -= this.calculateSize(val.value);\n    }\n    return val;\n  }\n  isEmpty() {\n    return this.head.isEmpty();\n  }\n}","map":{"version":3,"names":["FixedFIFO","constructor","hwm","_defineProperty","Error","buffer","Array","mask","top","btm","next","push","data","undefined","shift","last","isEmpty","FIFO","options","splitLimit","head","tail","size","calculateSize","obj","byteLength","val","value","prev","length"],"sources":["../../src/fifo.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}