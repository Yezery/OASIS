{"ast":null,"code":"import 'node-forge/lib/asn1.js';\nimport 'node-forge/lib/rsa.js';\nimport { CodeError } from '@libp2p/interfaces/errors';\n// @ts-expect-error types are missing\nimport forge from 'node-forge/lib/forge.js';\nimport { fromString as uint8ArrayFromString } from 'uint8arrays/from-string';\nimport { toString as uint8ArrayToString } from 'uint8arrays/to-string';\nimport { bigIntegerToUintBase64url, base64urlToBigInteger } from './../util.js';\n// Convert a PKCS#1 in ASN1 DER format to a JWK key\nexport function pkcs1ToJwk(bytes) {\n  const asn1 = forge.asn1.fromDer(uint8ArrayToString(bytes, 'ascii'));\n  const privateKey = forge.pki.privateKeyFromAsn1(asn1);\n  // https://tools.ietf.org/html/rfc7518#section-6.3.1\n  return {\n    kty: 'RSA',\n    n: bigIntegerToUintBase64url(privateKey.n),\n    e: bigIntegerToUintBase64url(privateKey.e),\n    d: bigIntegerToUintBase64url(privateKey.d),\n    p: bigIntegerToUintBase64url(privateKey.p),\n    q: bigIntegerToUintBase64url(privateKey.q),\n    dp: bigIntegerToUintBase64url(privateKey.dP),\n    dq: bigIntegerToUintBase64url(privateKey.dQ),\n    qi: bigIntegerToUintBase64url(privateKey.qInv),\n    alg: 'RS256'\n  };\n}\n// Convert a JWK key into PKCS#1 in ASN1 DER format\nexport function jwkToPkcs1(jwk) {\n  if (jwk.n == null || jwk.e == null || jwk.d == null || jwk.p == null || jwk.q == null || jwk.dp == null || jwk.dq == null || jwk.qi == null) {\n    throw new CodeError('JWK was missing components', 'ERR_INVALID_PARAMETERS');\n  }\n  const asn1 = forge.pki.privateKeyToAsn1({\n    n: base64urlToBigInteger(jwk.n),\n    e: base64urlToBigInteger(jwk.e),\n    d: base64urlToBigInteger(jwk.d),\n    p: base64urlToBigInteger(jwk.p),\n    q: base64urlToBigInteger(jwk.q),\n    dP: base64urlToBigInteger(jwk.dp),\n    dQ: base64urlToBigInteger(jwk.dq),\n    qInv: base64urlToBigInteger(jwk.qi)\n  });\n  return uint8ArrayFromString(forge.asn1.toDer(asn1).getBytes(), 'ascii');\n}\n// Convert a PKCIX in ASN1 DER format to a JWK key\nexport function pkixToJwk(bytes) {\n  const asn1 = forge.asn1.fromDer(uint8ArrayToString(bytes, 'ascii'));\n  const publicKey = forge.pki.publicKeyFromAsn1(asn1);\n  return {\n    kty: 'RSA',\n    n: bigIntegerToUintBase64url(publicKey.n),\n    e: bigIntegerToUintBase64url(publicKey.e)\n  };\n}\n// Convert a JWK key to PKCIX in ASN1 DER format\nexport function jwkToPkix(jwk) {\n  if (jwk.n == null || jwk.e == null) {\n    throw new CodeError('JWK was missing components', 'ERR_INVALID_PARAMETERS');\n  }\n  const asn1 = forge.pki.publicKeyToAsn1({\n    n: base64urlToBigInteger(jwk.n),\n    e: base64urlToBigInteger(jwk.e)\n  });\n  return uint8ArrayFromString(forge.asn1.toDer(asn1).getBytes(), 'ascii');\n}","map":{"version":3,"names":["CodeError","forge","fromString","uint8ArrayFromString","toString","uint8ArrayToString","bigIntegerToUintBase64url","base64urlToBigInteger","pkcs1ToJwk","bytes","asn1","fromDer","privateKey","pki","privateKeyFromAsn1","kty","n","e","d","p","q","dp","dP","dq","dQ","qi","qInv","alg","jwkToPkcs1","jwk","privateKeyToAsn1","toDer","getBytes","pkixToJwk","publicKey","publicKeyFromAsn1","jwkToPkix","publicKeyToAsn1"],"sources":["../../../src/keys/rsa-utils.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}