{"ast":null,"code":"import \"core-js/modules/es.typed-array.to-reversed.js\";\nimport \"core-js/modules/es.typed-array.to-sorted.js\";\nimport \"core-js/modules/es.typed-array.with.js\";\nimport { toString as uint8ArrayToString } from 'uint8arrays/to-string';\nimport { IpnsEntry } from './pb/ipns.js';\nimport { parseRFC3339 } from './utils.js';\nexport const ipnsSelector = (key, data) => {\n  const entries = data.map((buf, index) => ({\n    entry: IpnsEntry.decode(buf),\n    index\n  }));\n  entries.sort((a, b) => {\n    // having a newer signature version is better than an older signature version\n    if (a.entry.signatureV2 != null && b.entry.signatureV2 == null) {\n      return -1;\n    } else if (a.entry.signatureV2 == null && b.entry.signatureV2 != null) {\n      return 1;\n    }\n    const aSeq = a.entry.sequence ?? 0n;\n    const bSeq = b.entry.sequence ?? 0n;\n    // choose later sequence number\n    if (aSeq > bSeq) {\n      return -1;\n    } else if (aSeq < bSeq) {\n      return 1;\n    }\n    const aValidty = a.entry.validity ?? new Uint8Array(0);\n    const bValidty = b.entry.validity ?? new Uint8Array(0);\n    // choose longer lived record if sequence numbers the same\n    const entryAValidityDate = parseRFC3339(uint8ArrayToString(aValidty));\n    const entryBValidityDate = parseRFC3339(uint8ArrayToString(bValidty));\n    if (entryAValidityDate.getTime() > entryBValidityDate.getTime()) {\n      return -1;\n    }\n    if (entryAValidityDate.getTime() < entryBValidityDate.getTime()) {\n      return 1;\n    }\n    return 0;\n  });\n  return entries[0].index;\n};","map":{"version":3,"names":["toString","uint8ArrayToString","IpnsEntry","parseRFC3339","ipnsSelector","key","data","entries","map","buf","index","entry","decode","sort","a","b","signatureV2","aSeq","sequence","bSeq","aValidty","validity","Uint8Array","bValidty","entryAValidityDate","entryBValidityDate","getTime"],"sources":["../../src/selector.ts"],"sourcesContent":[null],"mappings":";;;AAAA,SAASA,QAAQ,IAAIC,kBAAkB,QAAQ,uBAAuB;AACtE,SAASC,SAAS,QAAQ,cAAc;AACxC,SAASC,YAAY,QAAQ,YAAY;AAGzC,OAAO,MAAMC,YAAY,GAAaA,CAACC,GAAG,EAAEC,IAAI,KAAI;EAClD,MAAMC,OAAO,GAAGD,IAAI,CAACE,GAAG,CAAC,CAACC,GAAG,EAAEC,KAAK,MAAM;IACxCC,KAAK,EAAET,SAAS,CAACU,MAAM,CAACH,GAAG,CAAC;IAC5BC;GACD,CAAC,CAAC;EAEHH,OAAO,CAACM,IAAI,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAI;IACpB;IACA,IAAID,CAAC,CAACH,KAAK,CAACK,WAAW,IAAI,IAAI,IAAID,CAAC,CAACJ,KAAK,CAACK,WAAW,IAAI,IAAI,EAAE;MAC9D,OAAO,CAAC,CAAC;KACV,MAAM,IAAIF,CAAC,CAACH,KAAK,CAACK,WAAW,IAAI,IAAI,IAAID,CAAC,CAACJ,KAAK,CAACK,WAAW,IAAI,IAAI,EAAE;MACrE,OAAO,CAAC;;IAGV,MAAMC,IAAI,GAAGH,CAAC,CAACH,KAAK,CAACO,QAAQ,IAAI,EAAE;IACnC,MAAMC,IAAI,GAAGJ,CAAC,CAACJ,KAAK,CAACO,QAAQ,IAAI,EAAE;IAEnC;IACA,IAAID,IAAI,GAAGE,IAAI,EAAE;MACf,OAAO,CAAC,CAAC;KACV,MAAM,IAAIF,IAAI,GAAGE,IAAI,EAAE;MACtB,OAAO,CAAC;;IAGV,MAAMC,QAAQ,GAAGN,CAAC,CAACH,KAAK,CAACU,QAAQ,IAAI,IAAIC,UAAU,CAAC,CAAC,CAAC;IACtD,MAAMC,QAAQ,GAAGR,CAAC,CAACJ,KAAK,CAACU,QAAQ,IAAI,IAAIC,UAAU,CAAC,CAAC,CAAC;IAEtD;IACA,MAAME,kBAAkB,GAAGrB,YAAY,CAACF,kBAAkB,CAACmB,QAAQ,CAAC,CAAC;IACrE,MAAMK,kBAAkB,GAAGtB,YAAY,CAACF,kBAAkB,CAACsB,QAAQ,CAAC,CAAC;IAErE,IAAIC,kBAAkB,CAACE,OAAO,EAAE,GAAGD,kBAAkB,CAACC,OAAO,EAAE,EAAE;MAC/D,OAAO,CAAC,CAAC;;IAGX,IAAIF,kBAAkB,CAACE,OAAO,EAAE,GAAGD,kBAAkB,CAACC,OAAO,EAAE,EAAE;MAC/D,OAAO,CAAC;;IAGV,OAAO,CAAC;EACV,CAAC,CAAC;EAEF,OAAOnB,OAAO,CAAC,CAAC,CAAC,CAACG,KAAK;AACzB,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}