{"ast":null,"code":"import _defineProperty from \"/Users/yezery/Oasis/OASIS/node_modules/.store/@babel+runtime@7.22.15/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport { EventEmitter } from 'events';\nimport { EventIterator } from 'event-iterator';\nimport { advertise } from './advertise/index.js';\nimport { adverts } from './adverts.js';\nimport { notify } from './commands/notify.js';\nimport { search } from './commands/search.js';\nimport { createSockets } from './create-sockets.js';\nimport { defaultSsdpOptions } from './default-ssdp-options.js';\nimport { discover } from './discover/index.js';\nimport { searchResponse } from './discover/search-response.js';\nimport { parseSsdpMessage } from './parse-ssdp-message.js';\nimport { sendSsdpMessage } from './send-ssdp-message.js';\nclass SSDPImpl extends EventEmitter {\n  constructor(options) {\n    super();\n    _defineProperty(this, \"udn\", void 0);\n    _defineProperty(this, \"signature\", void 0);\n    _defineProperty(this, \"sockets\", void 0);\n    _defineProperty(this, \"options\", void 0);\n    _defineProperty(this, \"abortController\", void 0);\n    this.options = defaultSsdpOptions(options);\n    this.udn = this.options.udn;\n    this.signature = this.options.signature;\n    this.sockets = [];\n    this.abortController = new AbortController();\n  }\n  async start() {\n    // set up UDP sockets listening for SSDP broadcasts\n    this.sockets = await createSockets(this, this.abortController.signal);\n    // set up protocol listeners\n    this.on('transport:incoming-message', parseSsdpMessage.bind(null, this));\n    this.on('ssdp:send-message', sendSsdpMessage.bind(null, this));\n    this.on('ssdp:m-search', search.bind(null, this));\n    this.on('ssdp:notify', notify.bind(null, this));\n    this.on('ssdp:search-response', searchResponse.bind(null, this));\n  }\n  async stop() {\n    await adverts.stopAll();\n    await Promise.all(this.sockets.map(async socket => {\n      await new Promise(resolve => {\n        socket.on('close', () => {\n          resolve();\n        });\n        socket.close();\n        socket.closed = true;\n      });\n    }));\n    this.abortController.abort();\n  }\n  async advertise(advert) {\n    return advertise(this, advert);\n  }\n  async *discover(serviceType) {\n    const iterator = new EventIterator(({\n      push\n    }) => {\n      const listener = service => {\n        if (serviceType != null && service.serviceType !== serviceType) {\n          return;\n        }\n        push(service);\n      };\n      this.addListener('service:discover', listener);\n      return () => {\n        this.removeListener('service:discover', listener);\n      };\n    });\n    discover(this, serviceType);\n    yield* iterator;\n  }\n}\nexport default async function (options = {}) {\n  const ssdp = new SSDPImpl(options);\n  if (options.start !== false) {\n    await ssdp.start();\n  }\n  return ssdp;\n}","map":{"version":3,"names":["EventEmitter","EventIterator","advertise","adverts","notify","search","createSockets","defaultSsdpOptions","discover","searchResponse","parseSsdpMessage","sendSsdpMessage","SSDPImpl","constructor","options","_defineProperty","udn","signature","sockets","abortController","AbortController","start","signal","on","bind","stop","stopAll","Promise","all","map","socket","resolve","close","closed","abort","advert","serviceType","iterator","push","listener","service","addListener","removeListener","ssdp"],"sources":["../../src/index.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}