{"ast":null,"code":"import \"core-js/modules/es.typed-array.to-reversed.js\";\nimport \"core-js/modules/es.typed-array.to-sorted.js\";\nimport \"core-js/modules/es.typed-array.with.js\";\nimport * as signing from './signing.js';\nimport * as encryption from './encryption.js';\nimport * as cbor from '@ipld/dag-cbor';\nexport const name = 'dag-jose';\nexport const code = 133;\nfunction isDagJWS(jose) {\n  return 'payload' in jose && typeof jose.payload === 'string' && 'signatures' in jose && Array.isArray(jose.signatures);\n}\nfunction isEncodedJWS(jose) {\n  return 'payload' in jose && jose.payload instanceof Uint8Array && 'signatures' in jose && Array.isArray(jose.signatures);\n}\nfunction isEncodedJWE(jose) {\n  return 'ciphertext' in jose && jose.ciphertext instanceof Uint8Array && 'iv' in jose && jose.iv instanceof Uint8Array && 'protected' in jose && jose.protected instanceof Uint8Array && 'tag' in jose && jose.tag instanceof Uint8Array;\n}\nfunction isDagJWE(jose) {\n  return 'ciphertext' in jose && typeof jose.ciphertext === 'string' && 'iv' in jose && typeof jose.iv === 'string' && 'protected' in jose && typeof jose.protected === 'string' && 'tag' in jose && typeof jose.tag === 'string';\n}\nexport function toGeneral(jose) {\n  if (typeof jose === 'string') {\n    const split = jose.split('.');\n    if (split.length === 3) {\n      return signing.fromSplit(split);\n    } else if (split.length === 5) {\n      return encryption.fromSplit(split);\n    }\n    throw new Error('Not a valid JOSE string');\n  }\n  if (isDagJWS(jose) || isDagJWE(jose)) {\n    return jose;\n  }\n  throw new Error('Not a valid unencoded JOSE object');\n}\nexport function encode(obj) {\n  if (typeof obj === 'string') {\n    obj = toGeneral(obj);\n  }\n  let encodedJose;\n  if (isDagJWS(obj)) {\n    encodedJose = signing.encode(obj);\n  } else if (isDagJWE(obj)) {\n    encodedJose = encryption.encode(obj);\n  } else {\n    throw new Error('Not a valid JOSE object');\n  }\n  return new Uint8Array(cbor.encode(encodedJose));\n}\nexport function decode(data) {\n  let encoded;\n  try {\n    encoded = cbor.decode(data);\n  } catch (e) {\n    throw new Error('Not a valid DAG-JOSE object');\n  }\n  if (isEncodedJWS(encoded)) {\n    return signing.decode(encoded);\n  } else if (isEncodedJWE(encoded)) {\n    return encryption.decode(encoded);\n  } else {\n    throw new Error('Not a valid DAG-JOSE object');\n  }\n}","map":{"version":3,"names":["signing","encryption","cbor","name","code","isDagJWS","jose","payload","Array","isArray","signatures","isEncodedJWS","Uint8Array","isEncodedJWE","ciphertext","iv","protected","tag","isDagJWE","toGeneral","split","length","fromSplit","Error","encode","obj","encodedJose","decode","data","encoded","e"],"sources":["../src/index.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}