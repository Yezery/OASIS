{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nfunction isIpv4Address(address) {\n  const parts = address.trim().split('.');\n  if (parts.length !== 4) {\n    return false;\n  }\n  for (let i = 0; i < parts.length; i++) {\n    const octet = parseInt(parts[i], 10);\n    if (octet < 0 || octet > 255) {\n      return false;\n    }\n  }\n  return true;\n}\nconst addressFamilyMismatch = (remote, socket) => {\n  return !(socket.type === 'udp4' && isIpv4Address(remote.address));\n};\nexport function sendSsdpMessage(ssdp, status, headers, remote) {\n  Promise.all(ssdp.sockets.map(async socket => {\n    await new Promise((resolve, reject) => {\n      if (socket.closed) {\n        resolve();\n        return;\n      }\n      const recipient = remote ?? socket.options.broadcast;\n      // don't send messages over udp6 sockets and expect them to reach upd4 recipients\n      if (recipient != null && addressFamilyMismatch(recipient, socket)) {\n        resolve();\n        return;\n      }\n      if (headers.LOCATION != null) {\n        // @ts-expect-error wat\n        headers.LOCATION = headers.LOCATION[socket.type];\n      }\n      const message = [status];\n      if (!status.startsWith('HTTP/1.1')) {\n        // not a response so insert the host header\n        message.push(`HOST: ${socket.options.broadcast.address}:${socket.options.broadcast.port}`);\n      }\n      Object.keys(headers).forEach(function (header) {\n        message.push(`${header}: ${headers[header]}`);\n      });\n      message.push('\\r\\n');\n      const buffer = Buffer.from(message.join('\\r\\n'));\n      ssdp.emit('transport:outgoing-message', socket, buffer, recipient);\n      socket.send(buffer, 0, buffer.length, recipient.port, recipient.address, error => {\n        if (error != null) {\n          reject(error);\n          return;\n        }\n        resolve();\n      });\n    });\n  })).catch(err => {\n    ssdp.emit('error', err);\n  });\n}","map":{"version":3,"names":["isIpv4Address","address","parts","trim","split","length","i","octet","parseInt","addressFamilyMismatch","remote","socket","type","sendSsdpMessage","ssdp","status","headers","Promise","all","sockets","map","resolve","reject","closed","recipient","options","broadcast","LOCATION","message","startsWith","push","port","Object","keys","forEach","header","buffer","Buffer","from","join","emit","send","error","catch","err"],"sources":["../../src/send-ssdp-message.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}