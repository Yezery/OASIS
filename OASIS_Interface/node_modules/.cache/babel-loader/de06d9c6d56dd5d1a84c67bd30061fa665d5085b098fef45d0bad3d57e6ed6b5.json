{"ast":null,"code":"'use strict';\n\nfunction dePalette(indata, outdata, width, height, palette) {\n  var pxPos = 0;\n  // use values from palette\n  for (var y = 0; y < height; y++) {\n    for (var x = 0; x < width; x++) {\n      var color = palette[indata[pxPos]];\n      if (!color) {\n        throw new Error('index ' + indata[pxPos] + ' not in palette');\n      }\n      for (var i = 0; i < 4; i++) {\n        outdata[pxPos + i] = color[i];\n      }\n      pxPos += 4;\n    }\n  }\n}\nfunction replaceTransparentColor(indata, outdata, width, height, transColor) {\n  var pxPos = 0;\n  for (var y = 0; y < height; y++) {\n    for (var x = 0; x < width; x++) {\n      var makeTrans = false;\n      if (transColor.length === 1) {\n        if (transColor[0] === indata[pxPos]) {\n          makeTrans = true;\n        }\n      } else if (transColor[0] === indata[pxPos] && transColor[1] === indata[pxPos + 1] && transColor[2] === indata[pxPos + 2]) {\n        makeTrans = true;\n      }\n      if (makeTrans) {\n        for (var i = 0; i < 4; i++) {\n          outdata[pxPos + i] = 0;\n        }\n      }\n      pxPos += 4;\n    }\n  }\n}\nfunction scaleDepth(indata, outdata, width, height, depth) {\n  var maxOutSample = 255;\n  var maxInSample = Math.pow(2, depth) - 1;\n  var pxPos = 0;\n  for (var y = 0; y < height; y++) {\n    for (var x = 0; x < width; x++) {\n      for (var i = 0; i < 4; i++) {\n        outdata[pxPos + i] = Math.floor(indata[pxPos + i] * maxOutSample / maxInSample + 0.5);\n      }\n      pxPos += 4;\n    }\n  }\n}\nmodule.exports = function (indata, imageData) {\n  var depth = imageData.depth;\n  var width = imageData.width;\n  var height = imageData.height;\n  var colorType = imageData.colorType;\n  var transColor = imageData.transColor;\n  var palette = imageData.palette;\n  var outdata = indata; // only different for 16 bits\n\n  if (colorType === 3) {\n    // paletted\n    dePalette(indata, outdata, width, height, palette);\n  } else {\n    if (transColor) {\n      replaceTransparentColor(indata, outdata, width, height, transColor);\n    }\n    // if it needs scaling\n    if (depth !== 8) {\n      // if we need to change the buffer size\n      if (depth === 16) {\n        outdata = new Buffer(width * height * 4);\n      }\n      scaleDepth(indata, outdata, width, height, depth);\n    }\n  }\n  return outdata;\n};","map":{"version":3,"names":["dePalette","indata","outdata","width","height","palette","pxPos","y","x","color","Error","i","replaceTransparentColor","transColor","makeTrans","length","scaleDepth","depth","maxOutSample","maxInSample","Math","pow","floor","module","exports","imageData","colorType","Buffer"],"sources":["/Users/yezery/Documents/大学素材/毕业设计/OASIS/OASIS_Interface/node_modules/.store/pngjs-nozlib@1.0.0/node_modules/pngjs-nozlib/lib/format-normaliser.js"],"sourcesContent":["'use strict';\n\nfunction dePalette(indata, outdata, width, height, palette) {\n  var pxPos = 0;\n  // use values from palette\n  for (var y = 0; y < height; y++) {\n    for (var x = 0; x < width; x++) {\n      var color = palette[indata[pxPos]];\n\n      if (!color) {\n        throw new Error('index ' + indata[pxPos] + ' not in palette');\n      }\n\n      for (var i = 0; i < 4; i++) {\n        outdata[pxPos + i] = color[i];\n      }\n      pxPos += 4;\n    }\n  }\n}\n\nfunction replaceTransparentColor(indata, outdata, width, height, transColor) {\n  var pxPos = 0;\n  for (var y = 0; y < height; y++) {\n    for (var x = 0; x < width; x++) {\n      var makeTrans = false;\n\n      if (transColor.length === 1) {\n        if (transColor[0] === indata[pxPos]) {\n          makeTrans = true;\n        }\n      }\n      else if (transColor[0] === indata[pxPos] && transColor[1] === indata[pxPos + 1] && transColor[2] === indata[pxPos + 2]) {\n        makeTrans = true;\n      }\n      if (makeTrans) {\n        for (var i = 0; i < 4; i++) {\n          outdata[pxPos + i] = 0;\n        }\n      }\n      pxPos += 4;\n    }\n  }\n}\n\nfunction scaleDepth(indata, outdata, width, height, depth) {\n  var maxOutSample = 255;\n  var maxInSample = Math.pow(2, depth) - 1;\n  var pxPos = 0;\n\n  for (var y = 0; y < height; y++) {\n    for (var x = 0; x < width; x++) {\n      for (var i = 0; i < 4; i++) {\n        outdata[pxPos + i] = Math.floor((indata[pxPos + i] * maxOutSample) / maxInSample + 0.5);\n      }\n      pxPos += 4;\n    }\n  }\n}\n\nmodule.exports = function(indata, imageData) {\n\n  var depth = imageData.depth;\n  var width = imageData.width;\n  var height = imageData.height;\n  var colorType = imageData.colorType;\n  var transColor = imageData.transColor;\n  var palette = imageData.palette;\n\n  var outdata = indata; // only different for 16 bits\n\n  if (colorType === 3) { // paletted\n    dePalette(indata, outdata, width, height, palette);\n  }\n  else {\n    if (transColor) {\n      replaceTransparentColor(indata, outdata, width, height, transColor);\n    }\n    // if it needs scaling\n    if (depth !== 8) {\n      // if we need to change the buffer size\n      if (depth === 16) {\n        outdata = new Buffer(width * height * 4);\n      }\n      scaleDepth(indata, outdata, width, height, depth);\n    }\n  }\n  return outdata;\n};\n"],"mappings":"AAAA,YAAY;;AAEZ,SAASA,SAASA,CAACC,MAAM,EAAEC,OAAO,EAAEC,KAAK,EAAEC,MAAM,EAAEC,OAAO,EAAE;EAC1D,IAAIC,KAAK,GAAG,CAAC;EACb;EACA,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGH,MAAM,EAAEG,CAAC,EAAE,EAAE;IAC/B,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGL,KAAK,EAAEK,CAAC,EAAE,EAAE;MAC9B,IAAIC,KAAK,GAAGJ,OAAO,CAACJ,MAAM,CAACK,KAAK,CAAC,CAAC;MAElC,IAAI,CAACG,KAAK,EAAE;QACV,MAAM,IAAIC,KAAK,CAAC,QAAQ,GAAGT,MAAM,CAACK,KAAK,CAAC,GAAG,iBAAiB,CAAC;MAC/D;MAEA,KAAK,IAAIK,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,CAAC,EAAEA,CAAC,EAAE,EAAE;QAC1BT,OAAO,CAACI,KAAK,GAAGK,CAAC,CAAC,GAAGF,KAAK,CAACE,CAAC,CAAC;MAC/B;MACAL,KAAK,IAAI,CAAC;IACZ;EACF;AACF;AAEA,SAASM,uBAAuBA,CAACX,MAAM,EAAEC,OAAO,EAAEC,KAAK,EAAEC,MAAM,EAAES,UAAU,EAAE;EAC3E,IAAIP,KAAK,GAAG,CAAC;EACb,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGH,MAAM,EAAEG,CAAC,EAAE,EAAE;IAC/B,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGL,KAAK,EAAEK,CAAC,EAAE,EAAE;MAC9B,IAAIM,SAAS,GAAG,KAAK;MAErB,IAAID,UAAU,CAACE,MAAM,KAAK,CAAC,EAAE;QAC3B,IAAIF,UAAU,CAAC,CAAC,CAAC,KAAKZ,MAAM,CAACK,KAAK,CAAC,EAAE;UACnCQ,SAAS,GAAG,IAAI;QAClB;MACF,CAAC,MACI,IAAID,UAAU,CAAC,CAAC,CAAC,KAAKZ,MAAM,CAACK,KAAK,CAAC,IAAIO,UAAU,CAAC,CAAC,CAAC,KAAKZ,MAAM,CAACK,KAAK,GAAG,CAAC,CAAC,IAAIO,UAAU,CAAC,CAAC,CAAC,KAAKZ,MAAM,CAACK,KAAK,GAAG,CAAC,CAAC,EAAE;QACtHQ,SAAS,GAAG,IAAI;MAClB;MACA,IAAIA,SAAS,EAAE;QACb,KAAK,IAAIH,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,CAAC,EAAEA,CAAC,EAAE,EAAE;UAC1BT,OAAO,CAACI,KAAK,GAAGK,CAAC,CAAC,GAAG,CAAC;QACxB;MACF;MACAL,KAAK,IAAI,CAAC;IACZ;EACF;AACF;AAEA,SAASU,UAAUA,CAACf,MAAM,EAAEC,OAAO,EAAEC,KAAK,EAAEC,MAAM,EAAEa,KAAK,EAAE;EACzD,IAAIC,YAAY,GAAG,GAAG;EACtB,IAAIC,WAAW,GAAGC,IAAI,CAACC,GAAG,CAAC,CAAC,EAAEJ,KAAK,CAAC,GAAG,CAAC;EACxC,IAAIX,KAAK,GAAG,CAAC;EAEb,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGH,MAAM,EAAEG,CAAC,EAAE,EAAE;IAC/B,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGL,KAAK,EAAEK,CAAC,EAAE,EAAE;MAC9B,KAAK,IAAIG,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,CAAC,EAAEA,CAAC,EAAE,EAAE;QAC1BT,OAAO,CAACI,KAAK,GAAGK,CAAC,CAAC,GAAGS,IAAI,CAACE,KAAK,CAAErB,MAAM,CAACK,KAAK,GAAGK,CAAC,CAAC,GAAGO,YAAY,GAAIC,WAAW,GAAG,GAAG,CAAC;MACzF;MACAb,KAAK,IAAI,CAAC;IACZ;EACF;AACF;AAEAiB,MAAM,CAACC,OAAO,GAAG,UAASvB,MAAM,EAAEwB,SAAS,EAAE;EAE3C,IAAIR,KAAK,GAAGQ,SAAS,CAACR,KAAK;EAC3B,IAAId,KAAK,GAAGsB,SAAS,CAACtB,KAAK;EAC3B,IAAIC,MAAM,GAAGqB,SAAS,CAACrB,MAAM;EAC7B,IAAIsB,SAAS,GAAGD,SAAS,CAACC,SAAS;EACnC,IAAIb,UAAU,GAAGY,SAAS,CAACZ,UAAU;EACrC,IAAIR,OAAO,GAAGoB,SAAS,CAACpB,OAAO;EAE/B,IAAIH,OAAO,GAAGD,MAAM,CAAC,CAAC;;EAEtB,IAAIyB,SAAS,KAAK,CAAC,EAAE;IAAE;IACrB1B,SAAS,CAACC,MAAM,EAAEC,OAAO,EAAEC,KAAK,EAAEC,MAAM,EAAEC,OAAO,CAAC;EACpD,CAAC,MACI;IACH,IAAIQ,UAAU,EAAE;MACdD,uBAAuB,CAACX,MAAM,EAAEC,OAAO,EAAEC,KAAK,EAAEC,MAAM,EAAES,UAAU,CAAC;IACrE;IACA;IACA,IAAII,KAAK,KAAK,CAAC,EAAE;MACf;MACA,IAAIA,KAAK,KAAK,EAAE,EAAE;QAChBf,OAAO,GAAG,IAAIyB,MAAM,CAACxB,KAAK,GAAGC,MAAM,GAAG,CAAC,CAAC;MAC1C;MACAY,UAAU,CAACf,MAAM,EAAEC,OAAO,EAAEC,KAAK,EAAEC,MAAM,EAAEa,KAAK,CAAC;IACnD;EACF;EACA,OAAOf,OAAO;AAChB,CAAC"},"metadata":{},"sourceType":"script","externalDependencies":[]}