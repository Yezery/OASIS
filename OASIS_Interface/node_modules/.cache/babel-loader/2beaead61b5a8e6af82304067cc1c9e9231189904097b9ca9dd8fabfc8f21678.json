{"ast":null,"code":"import \"core-js/modules/web.url-search-params.delete.js\";\nimport \"core-js/modules/web.url-search-params.has.js\";\nimport \"core-js/modules/web.url-search-params.size.js\";\nimport { cache } from '../cache.js';\nimport { resolveLocation } from './resolve-location.js';\nexport async function resolveService(ssdp, usn, st, location, ttl) {\n  // all arguments are required\n  if (ssdp == null || usn == null || st == null || location == null || ttl == null) {\n    return;\n  }\n  let newService = false;\n  let service = cache.getService(st, usn);\n  if (service == null) {\n    newService = true;\n    service = {\n      location: new URL(location),\n      details: {\n        pending: true\n      },\n      expires: 0,\n      serviceType: st,\n      uniqueServiceName: usn\n    };\n    cache.cacheService(service);\n  }\n  if (!newService) {\n    if (service.details.pending === true) {\n      // not yet loaded the advert details\n      return;\n    }\n  }\n  let oldDetails = null;\n  if (!newService) {\n    oldDetails = JSON.stringify(service.details);\n  }\n  try {\n    service.details = await resolveLocation(location);\n    service.expires = Date.now() + ttl;\n    cache.cacheService(service);\n    if (oldDetails === JSON.stringify(service.details)) {\n      // details have not changed, ignore the notify\n      return;\n    }\n    if (newService) {\n      ssdp.emit('service:discover', service);\n    } else {\n      ssdp.emit('service:update', service);\n    }\n  } catch (err) {\n    // remove it so we can try again later\n    cache.deleteService(st, usn);\n    ssdp.emit('error', err);\n  }\n}","map":{"version":3,"names":["cache","resolveLocation","resolveService","ssdp","usn","st","location","ttl","newService","service","getService","URL","details","pending","expires","serviceType","uniqueServiceName","cacheService","oldDetails","JSON","stringify","Date","now","emit","err","deleteService"],"sources":["../../../src/commands/resolve-service.ts"],"sourcesContent":[null],"mappings":";;;AAAA,SAASA,KAAK,QAAQ,aAAa;AACnC,SAASC,eAAe,QAAQ,uBAAuB;AAGvD,OAAO,eAAeC,cAAcA,CAAEC,IAAU,EAAEC,GAAW,EAAEC,EAAU,EAAEC,QAAgB,EAAEC,GAAW;EACtG;EACA,IAAIJ,IAAI,IAAI,IAAI,IAAIC,GAAG,IAAI,IAAI,IAAIC,EAAE,IAAI,IAAI,IAAIC,QAAQ,IAAI,IAAI,IAAIC,GAAG,IAAI,IAAI,EAAE;IAChF;;EAGF,IAAIC,UAAU,GAAG,KAAK;EACtB,IAAIC,OAAO,GAAGT,KAAK,CAACU,UAAU,CAACL,EAAE,EAAED,GAAG,CAAC;EAEvC,IAAIK,OAAO,IAAI,IAAI,EAAE;IACnBD,UAAU,GAAG,IAAI;IACjBC,OAAO,GAAG;MACRH,QAAQ,EAAE,IAAIK,GAAG,CAACL,QAAQ,CAAC;MAC3BM,OAAO,EAAE;QACPC,OAAO,EAAE;OACV;MACDC,OAAO,EAAE,CAAC;MACVC,WAAW,EAAEV,EAAE;MACfW,iBAAiB,EAAEZ;KACpB;IAEDJ,KAAK,CAACiB,YAAY,CAACR,OAAO,CAAC;;EAG7B,IAAI,CAACD,UAAU,EAAE;IACf,IAAIC,OAAO,CAACG,OAAO,CAACC,OAAO,KAAK,IAAI,EAAE;MACpC;MACA;;;EAIJ,IAAIK,UAAU,GAAG,IAAI;EAErB,IAAI,CAACV,UAAU,EAAE;IACfU,UAAU,GAAGC,IAAI,CAACC,SAAS,CAACX,OAAO,CAACG,OAAO,CAAC;;EAG9C,IAAI;IACFH,OAAO,CAACG,OAAO,GAAG,MAAMX,eAAe,CAACK,QAAQ,CAAC;IACjDG,OAAO,CAACK,OAAO,GAAGO,IAAI,CAACC,GAAG,EAAE,GAAGf,GAAG;IAElCP,KAAK,CAACiB,YAAY,CAACR,OAAO,CAAC;IAE3B,IAAIS,UAAU,KAAKC,IAAI,CAACC,SAAS,CAACX,OAAO,CAACG,OAAO,CAAC,EAAE;MAClD;MACA;;IAGF,IAAIJ,UAAU,EAAE;MACdL,IAAI,CAACoB,IAAI,CAAC,kBAAkB,EAAEd,OAAO,CAAC;KACvC,MAAM;MACLN,IAAI,CAACoB,IAAI,CAAC,gBAAgB,EAAEd,OAAO,CAAC;;GAEvC,CAAC,OAAOe,GAAQ,EAAE;IACjB;IACAxB,KAAK,CAACyB,aAAa,CAACpB,EAAE,EAAED,GAAG,CAAC;IAE5BD,IAAI,CAACoB,IAAI,CAAC,OAAO,EAAEC,GAAG,CAAC;;AAE3B"},"metadata":{},"sourceType":"module","externalDependencies":[]}