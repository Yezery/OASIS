{"ast":null,"code":"const Record = require('./Record');\nconst RateLimiterRes = require('../../RateLimiterRes');\nmodule.exports = class MemoryStorage {\n  constructor() {\n    /**\n     * @type {Object.<string, Record>}\n     * @private\n     */\n    this._storage = {};\n  }\n  incrby(key, value, durationSec) {\n    if (this._storage[key]) {\n      const msBeforeExpires = this._storage[key].expiresAt ? this._storage[key].expiresAt.getTime() - new Date().getTime() : -1;\n      if (msBeforeExpires !== 0) {\n        // Change value\n        this._storage[key].value = this._storage[key].value + value;\n        return new RateLimiterRes(0, msBeforeExpires, this._storage[key].value, false);\n      }\n      return this.set(key, value, durationSec);\n    }\n    return this.set(key, value, durationSec);\n  }\n  set(key, value, durationSec) {\n    const durationMs = durationSec * 1000;\n    if (this._storage[key] && this._storage[key].timeoutId) {\n      clearTimeout(this._storage[key].timeoutId);\n    }\n    this._storage[key] = new Record(value, durationMs > 0 ? new Date(Date.now() + durationMs) : null);\n    if (durationMs > 0) {\n      this._storage[key].timeoutId = setTimeout(() => {\n        delete this._storage[key];\n      }, durationMs);\n      if (this._storage[key].timeoutId.unref) {\n        this._storage[key].timeoutId.unref();\n      }\n    }\n    return new RateLimiterRes(0, durationMs === 0 ? -1 : durationMs, this._storage[key].value, true);\n  }\n\n  /**\n   *\n   * @param key\n   * @returns {*}\n   */\n  get(key) {\n    if (this._storage[key]) {\n      const msBeforeExpires = this._storage[key].expiresAt ? this._storage[key].expiresAt.getTime() - new Date().getTime() : -1;\n      return new RateLimiterRes(0, msBeforeExpires, this._storage[key].value, false);\n    }\n    return null;\n  }\n\n  /**\n   *\n   * @param key\n   * @returns {boolean}\n   */\n  delete(key) {\n    if (this._storage[key]) {\n      if (this._storage[key].timeoutId) {\n        clearTimeout(this._storage[key].timeoutId);\n      }\n      delete this._storage[key];\n      return true;\n    }\n    return false;\n  }\n};","map":{"version":3,"names":["Record","require","RateLimiterRes","module","exports","MemoryStorage","constructor","_storage","incrby","key","value","durationSec","msBeforeExpires","expiresAt","getTime","Date","set","durationMs","timeoutId","clearTimeout","now","setTimeout","unref","get","delete"],"sources":["/Users/yezery/Oasis/OASIS/node_modules/.store/rate-limiter-flexible@2.4.2/node_modules/rate-limiter-flexible/lib/component/MemoryStorage/MemoryStorage.js"],"sourcesContent":["const Record = require('./Record');\nconst RateLimiterRes = require('../../RateLimiterRes');\n\nmodule.exports = class MemoryStorage {\n  constructor() {\n    /**\n     * @type {Object.<string, Record>}\n     * @private\n     */\n    this._storage = {};\n  }\n\n  incrby(key, value, durationSec) {\n    if (this._storage[key]) {\n      const msBeforeExpires = this._storage[key].expiresAt\n        ? this._storage[key].expiresAt.getTime() - new Date().getTime()\n        : -1;\n      if (msBeforeExpires !== 0) {\n        // Change value\n        this._storage[key].value = this._storage[key].value + value;\n\n        return new RateLimiterRes(0, msBeforeExpires, this._storage[key].value, false);\n      }\n\n      return this.set(key, value, durationSec);\n    }\n    return this.set(key, value, durationSec);\n  }\n\n  set(key, value, durationSec) {\n    const durationMs = durationSec * 1000;\n\n    if (this._storage[key] && this._storage[key].timeoutId) {\n      clearTimeout(this._storage[key].timeoutId);\n    }\n\n    this._storage[key] = new Record(\n      value,\n      durationMs > 0 ? new Date(Date.now() + durationMs) : null\n    );\n    if (durationMs > 0) {\n      this._storage[key].timeoutId = setTimeout(() => {\n        delete this._storage[key];\n      }, durationMs);\n      if (this._storage[key].timeoutId.unref) {\n        this._storage[key].timeoutId.unref();\n      }\n    }\n\n    return new RateLimiterRes(0, durationMs === 0 ? -1 : durationMs, this._storage[key].value, true);\n  }\n\n  /**\n   *\n   * @param key\n   * @returns {*}\n   */\n  get(key) {\n    if (this._storage[key]) {\n      const msBeforeExpires = this._storage[key].expiresAt\n        ? this._storage[key].expiresAt.getTime() - new Date().getTime()\n        : -1;\n      return new RateLimiterRes(0, msBeforeExpires, this._storage[key].value, false);\n    }\n    return null;\n  }\n\n  /**\n   *\n   * @param key\n   * @returns {boolean}\n   */\n  delete(key) {\n    if (this._storage[key]) {\n      if (this._storage[key].timeoutId) {\n        clearTimeout(this._storage[key].timeoutId);\n      }\n      delete this._storage[key];\n      return true;\n    }\n    return false;\n  }\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}