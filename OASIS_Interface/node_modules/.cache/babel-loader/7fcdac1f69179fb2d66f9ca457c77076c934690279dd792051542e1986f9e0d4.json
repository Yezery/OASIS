{"ast":null,"code":"'use strict';\n\nconst {\n  AbstractIterator,\n  AbstractKeyIterator,\n  AbstractValueIterator\n} = require('../abstract-iterator');\nconst ModuleError = require('module-error');\nconst kNut = Symbol('nut');\nconst kUndefer = Symbol('undefer');\nconst kFactory = Symbol('factory');\nclass DeferredIterator extends AbstractIterator {\n  constructor(db, options) {\n    super(db, options);\n    this[kNut] = null;\n    this[kFactory] = () => db.iterator(options);\n    this.db.defer(() => this[kUndefer]());\n  }\n}\nclass DeferredKeyIterator extends AbstractKeyIterator {\n  constructor(db, options) {\n    super(db, options);\n    this[kNut] = null;\n    this[kFactory] = () => db.keys(options);\n    this.db.defer(() => this[kUndefer]());\n  }\n}\nclass DeferredValueIterator extends AbstractValueIterator {\n  constructor(db, options) {\n    super(db, options);\n    this[kNut] = null;\n    this[kFactory] = () => db.values(options);\n    this.db.defer(() => this[kUndefer]());\n  }\n}\nfor (const Iterator of [DeferredIterator, DeferredKeyIterator, DeferredValueIterator]) {\n  Iterator.prototype[kUndefer] = function () {\n    if (this.db.status === 'open') {\n      this[kNut] = this[kFactory]();\n    }\n  };\n  Iterator.prototype._next = function (callback) {\n    if (this[kNut] !== null) {\n      this[kNut].next(callback);\n    } else if (this.db.status === 'opening') {\n      this.db.defer(() => this._next(callback));\n    } else {\n      this.nextTick(callback, new ModuleError('Iterator is not open: cannot call next() after close()', {\n        code: 'LEVEL_ITERATOR_NOT_OPEN'\n      }));\n    }\n  };\n  Iterator.prototype._nextv = function (size, options, callback) {\n    if (this[kNut] !== null) {\n      this[kNut].nextv(size, options, callback);\n    } else if (this.db.status === 'opening') {\n      this.db.defer(() => this._nextv(size, options, callback));\n    } else {\n      this.nextTick(callback, new ModuleError('Iterator is not open: cannot call nextv() after close()', {\n        code: 'LEVEL_ITERATOR_NOT_OPEN'\n      }));\n    }\n  };\n  Iterator.prototype._all = function (options, callback) {\n    if (this[kNut] !== null) {\n      this[kNut].all(callback);\n    } else if (this.db.status === 'opening') {\n      this.db.defer(() => this._all(options, callback));\n    } else {\n      this.nextTick(callback, new ModuleError('Iterator is not open: cannot call all() after close()', {\n        code: 'LEVEL_ITERATOR_NOT_OPEN'\n      }));\n    }\n  };\n  Iterator.prototype._seek = function (target, options) {\n    if (this[kNut] !== null) {\n      // TODO: explain why we need _seek() rather than seek() here\n      this[kNut]._seek(target, options);\n    } else if (this.db.status === 'opening') {\n      this.db.defer(() => this._seek(target, options));\n    }\n  };\n  Iterator.prototype._close = function (callback) {\n    if (this[kNut] !== null) {\n      this[kNut].close(callback);\n    } else if (this.db.status === 'opening') {\n      this.db.defer(() => this._close(callback));\n    } else {\n      this.nextTick(callback);\n    }\n  };\n}\nexports.DeferredIterator = DeferredIterator;\nexports.DeferredKeyIterator = DeferredKeyIterator;\nexports.DeferredValueIterator = DeferredValueIterator;","map":{"version":3,"names":["AbstractIterator","AbstractKeyIterator","AbstractValueIterator","require","ModuleError","kNut","Symbol","kUndefer","kFactory","DeferredIterator","constructor","db","options","iterator","defer","DeferredKeyIterator","keys","DeferredValueIterator","values","Iterator","prototype","status","_next","callback","next","nextTick","code","_nextv","size","nextv","_all","all","_seek","target","_close","close","exports"],"sources":["/Users/yezery/Oasis/OASIS/node_modules/.store/abstract-level@1.0.3/node_modules/abstract-level/lib/deferred-iterator.js"],"sourcesContent":["'use strict'\n\nconst { AbstractIterator, AbstractKeyIterator, AbstractValueIterator } = require('../abstract-iterator')\nconst ModuleError = require('module-error')\n\nconst kNut = Symbol('nut')\nconst kUndefer = Symbol('undefer')\nconst kFactory = Symbol('factory')\n\nclass DeferredIterator extends AbstractIterator {\n  constructor (db, options) {\n    super(db, options)\n\n    this[kNut] = null\n    this[kFactory] = () => db.iterator(options)\n\n    this.db.defer(() => this[kUndefer]())\n  }\n}\n\nclass DeferredKeyIterator extends AbstractKeyIterator {\n  constructor (db, options) {\n    super(db, options)\n\n    this[kNut] = null\n    this[kFactory] = () => db.keys(options)\n\n    this.db.defer(() => this[kUndefer]())\n  }\n}\n\nclass DeferredValueIterator extends AbstractValueIterator {\n  constructor (db, options) {\n    super(db, options)\n\n    this[kNut] = null\n    this[kFactory] = () => db.values(options)\n\n    this.db.defer(() => this[kUndefer]())\n  }\n}\n\nfor (const Iterator of [DeferredIterator, DeferredKeyIterator, DeferredValueIterator]) {\n  Iterator.prototype[kUndefer] = function () {\n    if (this.db.status === 'open') {\n      this[kNut] = this[kFactory]()\n    }\n  }\n\n  Iterator.prototype._next = function (callback) {\n    if (this[kNut] !== null) {\n      this[kNut].next(callback)\n    } else if (this.db.status === 'opening') {\n      this.db.defer(() => this._next(callback))\n    } else {\n      this.nextTick(callback, new ModuleError('Iterator is not open: cannot call next() after close()', {\n        code: 'LEVEL_ITERATOR_NOT_OPEN'\n      }))\n    }\n  }\n\n  Iterator.prototype._nextv = function (size, options, callback) {\n    if (this[kNut] !== null) {\n      this[kNut].nextv(size, options, callback)\n    } else if (this.db.status === 'opening') {\n      this.db.defer(() => this._nextv(size, options, callback))\n    } else {\n      this.nextTick(callback, new ModuleError('Iterator is not open: cannot call nextv() after close()', {\n        code: 'LEVEL_ITERATOR_NOT_OPEN'\n      }))\n    }\n  }\n\n  Iterator.prototype._all = function (options, callback) {\n    if (this[kNut] !== null) {\n      this[kNut].all(callback)\n    } else if (this.db.status === 'opening') {\n      this.db.defer(() => this._all(options, callback))\n    } else {\n      this.nextTick(callback, new ModuleError('Iterator is not open: cannot call all() after close()', {\n        code: 'LEVEL_ITERATOR_NOT_OPEN'\n      }))\n    }\n  }\n\n  Iterator.prototype._seek = function (target, options) {\n    if (this[kNut] !== null) {\n      // TODO: explain why we need _seek() rather than seek() here\n      this[kNut]._seek(target, options)\n    } else if (this.db.status === 'opening') {\n      this.db.defer(() => this._seek(target, options))\n    }\n  }\n\n  Iterator.prototype._close = function (callback) {\n    if (this[kNut] !== null) {\n      this[kNut].close(callback)\n    } else if (this.db.status === 'opening') {\n      this.db.defer(() => this._close(callback))\n    } else {\n      this.nextTick(callback)\n    }\n  }\n}\n\nexports.DeferredIterator = DeferredIterator\nexports.DeferredKeyIterator = DeferredKeyIterator\nexports.DeferredValueIterator = DeferredValueIterator\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}