{"ast":null,"code":"import { multiaddr } from '@multiformats/multiaddr';\n/*\n * Valid combinations\n */\nexport const DNS4 = base('dns4');\nexport const DNS6 = base('dns6');\nexport const DNSADDR = base('dnsaddr');\nexport const DNS = or(base('dns'), DNSADDR, DNS4, DNS6);\nexport const IP = or(base('ip4'), base('ip6'));\nexport const TCP = or(and(IP, base('tcp')), and(DNS, base('tcp')));\nexport const UDP = and(IP, base('udp'));\nexport const UTP = and(UDP, base('utp'));\nexport const QUIC = and(UDP, base('quic'));\nexport const QUICV1 = and(UDP, base('quic-v1'));\nconst _WebSockets = or(and(TCP, base('ws')), and(DNS, base('ws')));\nexport const WebSockets = or(and(_WebSockets, base('p2p')), _WebSockets);\nconst _WebSocketsSecure = or(and(TCP, base('wss')), and(DNS, base('wss')), and(TCP, base('tls'), base('ws')), and(DNS, base('tls'), base('ws')));\nexport const WebSocketsSecure = or(and(_WebSocketsSecure, base('p2p')), _WebSocketsSecure);\nexport const HTTP = or(and(TCP, base('http')), and(IP, base('http')), and(DNS, base('http')));\nexport const HTTPS = or(and(TCP, base('https')), and(IP, base('https')), and(DNS, base('https')));\nconst _WebRTCDirect = and(UDP, base('webrtc-direct'), base('certhash'));\nexport const WebRTCDirect = or(and(_WebRTCDirect, base('p2p')), _WebRTCDirect);\nconst _WebTransport = and(QUICV1, base('webtransport'), base('certhash'), base('certhash'));\nexport const WebTransport = or(and(_WebTransport, base('p2p')), _WebTransport);\n/**\n * @deprecated\n */\nexport const P2PWebRTCStar = or(and(WebSockets, base('p2p-webrtc-star'), base('p2p')), and(WebSocketsSecure, base('p2p-webrtc-star'), base('p2p')), and(WebSockets, base('p2p-webrtc-star')), and(WebSocketsSecure, base('p2p-webrtc-star')));\nexport const WebSocketStar = or(and(WebSockets, base('p2p-websocket-star'), base('p2p')), and(WebSocketsSecure, base('p2p-websocket-star'), base('p2p')), and(WebSockets, base('p2p-websocket-star')), and(WebSocketsSecure, base('p2p-websocket-star')));\n/**\n * @deprecated\n */\nexport const P2PWebRTCDirect = or(and(HTTP, base('p2p-webrtc-direct'), base('p2p')), and(HTTPS, base('p2p-webrtc-direct'), base('p2p')), and(HTTP, base('p2p-webrtc-direct')), and(HTTPS, base('p2p-webrtc-direct')));\nexport const Reliable = or(_WebSockets, _WebSocketsSecure, HTTP, HTTPS, P2PWebRTCStar, P2PWebRTCDirect, TCP, UTP, QUIC, DNS, WebRTCDirect, WebTransport);\n// Unlike ws-star, stardust can run over any transport thus removing the requirement for websockets (but don't even think about running a stardust server over webrtc-star ;) )\nexport const Stardust = or(and(Reliable, base('p2p-stardust'), base('p2p')), and(Reliable, base('p2p-stardust')));\nconst _P2P = or(and(Reliable, base('p2p')), P2PWebRTCStar, P2PWebRTCDirect, WebRTCDirect, WebTransport, base('p2p'));\nconst _Circuit = or(and(_P2P, base('p2p-circuit'), _P2P), and(_P2P, base('p2p-circuit')), and(base('p2p-circuit'), _P2P), and(Reliable, base('p2p-circuit')), and(base('p2p-circuit'), Reliable), base('p2p-circuit'));\nconst CircuitRecursive = () => or(and(_Circuit, CircuitRecursive), _Circuit);\nexport const Circuit = CircuitRecursive();\nexport const P2P = or(and(Circuit, _P2P, Circuit), and(_P2P, Circuit), and(Circuit, _P2P), Circuit, _P2P);\nexport const IPFS = P2P;\nexport const WebRTC = or(and(Circuit, base('webrtc'), base('p2p')), and(Circuit, base('webrtc')), and(Reliable, base('webrtc'), base('p2p')), and(Reliable, base('webrtc')), base('webrtc'));\n/*\n * Validation funcs\n */\nfunction makeMatchesFunction(partialMatch) {\n  function matches(a) {\n    let ma;\n    try {\n      ma = multiaddr(a);\n    } catch (err) {\n      // catch error\n      return false; // also if it's invalid it's probably not matching as well so return false\n    }\n\n    const out = partialMatch(ma.protoNames());\n    if (out === null) {\n      return false;\n    }\n    if (out === true || out === false) {\n      return out;\n    }\n    return out.length === 0;\n  }\n  return matches;\n}\nfunction and(...args) {\n  function partialMatch(a) {\n    if (a.length < args.length) {\n      return null;\n    }\n    let out = a;\n    args.some(arg => {\n      out = typeof arg === 'function' ? arg().partialMatch(a) : arg.partialMatch(a);\n      if (Array.isArray(out)) {\n        a = out;\n      }\n      if (out === null) {\n        return true;\n      }\n      return false;\n    });\n    return out;\n  }\n  return {\n    toString: function () {\n      return '{ ' + args.join(' ') + ' }';\n    },\n    input: args,\n    matches: makeMatchesFunction(partialMatch),\n    partialMatch\n  };\n}\nfunction or(...args) {\n  function partialMatch(a) {\n    let out = null;\n    args.some(arg => {\n      const res = typeof arg === 'function' ? arg().partialMatch(a) : arg.partialMatch(a);\n      if (res != null) {\n        out = res;\n        return true;\n      }\n      return false;\n    });\n    return out;\n  }\n  const result = {\n    toString: function () {\n      return '{ ' + args.join(' ') + ' }';\n    },\n    input: args,\n    matches: makeMatchesFunction(partialMatch),\n    partialMatch\n  };\n  return result;\n}\nfunction base(n) {\n  const name = n;\n  function matches(a) {\n    let ma;\n    try {\n      ma = multiaddr(a);\n    } catch (err) {\n      // catch error\n      return false; // also if it's invalid it's probably not matching as well so return false\n    }\n\n    const pnames = ma.protoNames();\n    if (pnames.length === 1 && pnames[0] === name) {\n      return true;\n    }\n    return false;\n  }\n  function partialMatch(protos) {\n    if (protos.length === 0) {\n      return null;\n    }\n    if (protos[0] === name) {\n      return protos.slice(1);\n    }\n    return null;\n  }\n  return {\n    toString: function () {\n      return name;\n    },\n    matches,\n    partialMatch\n  };\n}","map":{"version":3,"names":["multiaddr","DNS4","base","DNS6","DNSADDR","DNS","or","IP","TCP","and","UDP","UTP","QUIC","QUICV1","_WebSockets","WebSockets","_WebSocketsSecure","WebSocketsSecure","HTTP","HTTPS","_WebRTCDirect","WebRTCDirect","_WebTransport","WebTransport","P2PWebRTCStar","WebSocketStar","P2PWebRTCDirect","Reliable","Stardust","_P2P","_Circuit","CircuitRecursive","Circuit","P2P","IPFS","WebRTC","makeMatchesFunction","partialMatch","matches","a","ma","err","out","protoNames","length","args","some","arg","Array","isArray","toString","join","input","res","result","n","name","pnames","protos","slice"],"sources":["../../src/index.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}