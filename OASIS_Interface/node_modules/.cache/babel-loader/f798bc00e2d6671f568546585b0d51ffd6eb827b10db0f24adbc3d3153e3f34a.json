{"ast":null,"code":"import { createSocket } from 'dgram';\nexport async function createSockets(ssdp, signal) {\n  return Promise.all(ssdp.options.sockets.map(async options => {\n    return new Promise((resolve, reject) => {\n      const socket = createSocket({\n        type: options.type,\n        reuseAddr: true,\n        signal\n      }, (buf, info) => {\n        ssdp.emit('transport:incoming-message', buf, info);\n      });\n      socket.bind(options.bind.port, options.bind.address);\n      // @ts-expect-error .options is not a property of Socket\n      socket.options = options;\n      socket.on('error', err => {\n        ssdp.emit('error', err);\n      });\n      socket.on('listening', () => {\n        try {\n          socket.addMembership(options.broadcast.address, socket.address().address);\n          socket.setBroadcast(true);\n          socket.setMulticastTTL(options.maxHops);\n          resolve(socket);\n        } catch (error) {\n          error.message = `Adding membership ${options.broadcast.address} failed - ${error.message}`; // eslint-disable-line @typescript-eslint/restrict-template-expressions\n          reject(error);\n        }\n      });\n    });\n  }));\n}","map":{"version":3,"names":["createSocket","createSockets","ssdp","signal","Promise","all","options","sockets","map","resolve","reject","socket","type","reuseAddr","buf","info","emit","bind","port","address","on","err","addMembership","broadcast","setBroadcast","setMulticastTTL","maxHops","error","message"],"sources":["../../src/create-sockets.ts"],"sourcesContent":[null],"mappings":"AAAA,SAASA,YAAY,QAAQ,OAAO;AAGpC,OAAO,eAAeC,aAAaA,CAAEC,IAAU,EAAEC,MAAmB;EAClE,OAAOC,OAAO,CAACC,GAAG,CAChBH,IAAI,CAACI,OAAO,CAACC,OAAO,CAACC,GAAG,CAAC,MAAMF,OAAO,IAAG;IACvC,OAAO,IAAIF,OAAO,CAAa,CAACK,OAAO,EAAEC,MAAM,KAAI;MACjD,MAAMC,MAAM,GAAGX,YAAY,CAAC;QAC1BY,IAAI,EAAEN,OAAO,CAACM,IAAI;QAClBC,SAAS,EAAE,IAAI;QACfV;OACD,EAAE,CAACW,GAAG,EAAEC,IAAI,KAAI;QACfb,IAAI,CAACc,IAAI,CAAC,4BAA4B,EAAEF,GAAG,EAAEC,IAAI,CAAC;MACpD,CAAC,CAAC;MACFJ,MAAM,CAACM,IAAI,CAACX,OAAO,CAACW,IAAI,CAACC,IAAI,EAAEZ,OAAO,CAACW,IAAI,CAACE,OAAO,CAAC;MACpD;MACAR,MAAM,CAACL,OAAO,GAAGA,OAAO;MACxBK,MAAM,CAACS,EAAE,CAAC,OAAO,EAAGC,GAAG,IAAI;QACzBnB,IAAI,CAACc,IAAI,CAAC,OAAO,EAAEK,GAAG,CAAC;MACzB,CAAC,CAAC;MACFV,MAAM,CAACS,EAAE,CAAC,WAAW,EAAE,MAAK;QAC1B,IAAI;UACFT,MAAM,CAACW,aAAa,CAAChB,OAAO,CAACiB,SAAS,CAACJ,OAAO,EAAER,MAAM,CAACQ,OAAO,EAAE,CAACA,OAAO,CAAC;UACzER,MAAM,CAACa,YAAY,CAAC,IAAI,CAAC;UACzBb,MAAM,CAACc,eAAe,CAACnB,OAAO,CAACoB,OAAO,CAAC;UAEvCjB,OAAO,CAACE,MAAoB,CAAC;SAC9B,CAAC,OAAOgB,KAAU,EAAE;UACnBA,KAAK,CAACC,OAAO,GAAG,qBAAqBtB,OAAO,CAACiB,SAAS,CAACJ,OAAO,aAAaQ,KAAK,CAACC,OAAO,EAAE,EAAC;UAC3FlB,MAAM,CAACiB,KAAK,CAAC;;MAEjB,CAAC,CAAC;IACJ,CAAC,CAAC;EACJ,CAAC,CAAC,CACH;AACH"},"metadata":{},"sourceType":"module","externalDependencies":[]}