{"ast":null,"code":"\"use strict\";\n\nrequire(\"core-js/modules/es.array.push.js\");\nrequire(\"core-js/modules/es.typed-array.to-reversed.js\");\nrequire(\"core-js/modules/es.typed-array.to-sorted.js\");\nrequire(\"core-js/modules/es.typed-array.with.js\");\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function () {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n      label: 0,\n      sent: function () {\n        if (t[0] & 1) throw t[1];\n        return t[1];\n      },\n      trys: [],\n      ops: []\n    },\n    f,\n    y,\n    t,\n    g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n        case 7:\n          op = _.ops.pop();\n          _.trys.pop();\n          continue;\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n            _.ops.push(op);\n            break;\n          }\n          if (t[2]) _.ops.pop();\n          _.trys.pop();\n          continue;\n      }\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.NSFWJS = exports.load = void 0;\nvar tf = __importStar(require(\"@tensorflow/tfjs\"));\nvar nsfw_classes_1 = require(\"./nsfw_classes\");\nvar gif_frames_1 = __importDefault(require(\"@nsfw-filter/gif-frames\"));\nvar BASE_PATH = \"https://d1zv2aa70wpiur.cloudfront.net/tfjs_quant_nsfw_mobilenet/\";\nvar IMAGE_SIZE = 224;\nfunction load(base, options) {\n  if (base === void 0) {\n    base = BASE_PATH;\n  }\n  if (options === void 0) {\n    options = {\n      size: IMAGE_SIZE\n    };\n  }\n  return __awaiter(this, void 0, void 0, function () {\n    var nsfwnet;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          if (tf == null) {\n            throw new Error(\"Cannot find TensorFlow.js. If you are using a <script> tag, please \" + \"also include @tensorflow/tfjs on the page before using this model.\");\n          }\n          options.size = options.size || IMAGE_SIZE;\n          nsfwnet = new NSFWJS(base, options);\n          return [4, nsfwnet.load()];\n        case 1:\n          _a.sent();\n          return [2, nsfwnet];\n      }\n    });\n  });\n}\nexports.load = load;\nvar NSFWJS = function () {\n  function NSFWJS(modelPathBaseOrIOHandler, options) {\n    this.intermediateModels = {};\n    this.options = options;\n    this.normalizationOffset = tf.scalar(255);\n    if (typeof modelPathBaseOrIOHandler === \"string\" && !modelPathBaseOrIOHandler.startsWith(\"indexeddb://\") && !modelPathBaseOrIOHandler.startsWith(\"localstorage://\")) {\n      if (modelPathBaseOrIOHandler.endsWith(\"model.json\")) {\n        this.pathOrIOHandler = modelPathBaseOrIOHandler;\n      } else {\n        this.pathOrIOHandler = modelPathBaseOrIOHandler + \"model.json\";\n      }\n    } else {\n      this.pathOrIOHandler = modelPathBaseOrIOHandler;\n    }\n  }\n  NSFWJS.prototype.load = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, size, type, _b, _c, result;\n      var _this = this;\n      return __generator(this, function (_d) {\n        switch (_d.label) {\n          case 0:\n            _a = this.options, size = _a.size, type = _a.type;\n            if (!(type === \"graph\")) return [3, 2];\n            _b = this;\n            return [4, tf.loadGraphModel(this.pathOrIOHandler)];\n          case 1:\n            _b.model = _d.sent();\n            return [3, 4];\n          case 2:\n            _c = this;\n            return [4, tf.loadLayersModel(this.pathOrIOHandler)];\n          case 3:\n            _c.model = _d.sent();\n            this.endpoints = this.model.layers.map(function (l) {\n              return l.name;\n            });\n            _d.label = 4;\n          case 4:\n            result = tf.tidy(function () {\n              return _this.model.predict(tf.zeros([1, size, size, 3]));\n            });\n            return [4, result.data()];\n          case 5:\n            _d.sent();\n            result.dispose();\n            return [2];\n        }\n      });\n    });\n  };\n  NSFWJS.prototype.infer = function (img, endpoint) {\n    var _this = this;\n    if (endpoint != null && this.endpoints.indexOf(endpoint) === -1) {\n      throw new Error(\"Unknown endpoint \" + endpoint + \". Available endpoints: \" + (this.endpoints + \".\"));\n    }\n    return tf.tidy(function () {\n      if (!(img instanceof tf.Tensor)) {\n        img = tf.browser.fromPixels(img);\n      }\n      var normalized = img.toFloat().div(_this.normalizationOffset);\n      var resized = normalized;\n      var size = _this.options.size;\n      if (img.shape[0] !== size || img.shape[1] !== size) {\n        var alignCorners = true;\n        resized = tf.image.resizeBilinear(normalized, [size, size], alignCorners);\n      }\n      var batched = resized.reshape([1, size, size, 3]);\n      var model;\n      if (endpoint == null) {\n        model = _this.model;\n      } else {\n        if (_this.model.hasOwnProperty(\"layers\") && _this.intermediateModels[endpoint] == null) {\n          var layer = _this.model.layers.find(function (l) {\n            return l.name === endpoint;\n          });\n          _this.intermediateModels[endpoint] = tf.model({\n            inputs: _this.model.inputs,\n            outputs: layer.output\n          });\n        }\n        model = _this.intermediateModels[endpoint];\n      }\n      return model.predict(batched);\n    });\n  };\n  NSFWJS.prototype.classify = function (img, topk) {\n    if (topk === void 0) {\n      topk = 5;\n    }\n    return __awaiter(this, void 0, void 0, function () {\n      var logits, classes;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            logits = this.infer(img);\n            return [4, getTopKClasses(logits, topk)];\n          case 1:\n            classes = _a.sent();\n            logits.dispose();\n            return [2, classes];\n        }\n      });\n    });\n  };\n  NSFWJS.prototype.classifyGif = function (gif, config) {\n    if (config === void 0) {\n      config = {\n        topk: 5\n      };\n    }\n    return __awaiter(this, void 0, void 0, function () {\n      var frameData, acceptedFrames, totalTimeInMs, i, totalFrames, interval, i, arrayOfPredictions, i, image, predictions;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            frameData = [];\n            if (!Buffer.isBuffer(gif)) return [3, 2];\n            return [4, gif_frames_1.default({\n              url: gif,\n              frames: 'all',\n              outputType: 'jpg'\n            })];\n          case 1:\n            frameData = _a.sent();\n            return [3, 4];\n          case 2:\n            return [4, gif_frames_1.default({\n              url: gif.src,\n              frames: 'all',\n              outputType: 'canvas'\n            })];\n          case 3:\n            frameData = _a.sent();\n            _a.label = 4;\n          case 4:\n            acceptedFrames = [];\n            if (typeof config.fps !== 'number') {\n              acceptedFrames = frameData.map(function (_element, index) {\n                return index;\n              });\n            } else {\n              totalTimeInMs = 0;\n              for (i = 0; i < frameData.length; i++) {\n                totalTimeInMs = totalTimeInMs + frameData[i].frameInfo.delay * 10;\n              }\n              totalFrames = Math.floor(totalTimeInMs / 1000 * config.fps);\n              if (totalFrames <= 1) {\n                acceptedFrames = [Math.floor(frameData.length / 2)];\n              } else if (totalFrames >= frameData.length) {\n                acceptedFrames = frameData.map(function (_element, index) {\n                  return index;\n                });\n              } else {\n                interval = Math.floor(frameData.length / (totalFrames + 1));\n                for (i = 1; i <= totalFrames; i++) {\n                  acceptedFrames.push(i * interval);\n                }\n              }\n            }\n            arrayOfPredictions = [];\n            i = 0;\n            _a.label = 5;\n          case 5:\n            if (!(i < acceptedFrames.length)) return [3, 8];\n            image = frameData[acceptedFrames[i]].getImage();\n            return [4, this.classify(image, config.topk)];\n          case 6:\n            predictions = _a.sent();\n            if (typeof config.onFrame === 'function') {\n              config.onFrame({\n                index: acceptedFrames[i],\n                totalFrames: frameData.length,\n                predictions: predictions,\n                image: image\n              });\n            }\n            arrayOfPredictions.push(predictions);\n            _a.label = 7;\n          case 7:\n            i++;\n            return [3, 5];\n          case 8:\n            return [2, arrayOfPredictions];\n        }\n      });\n    });\n  };\n  return NSFWJS;\n}();\nexports.NSFWJS = NSFWJS;\nfunction getTopKClasses(logits, topK) {\n  return __awaiter(this, void 0, void 0, function () {\n    var values, valuesAndIndices, i, topkValues, topkIndices, i, topClassesAndProbs, i;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4, logits.data()];\n        case 1:\n          values = _a.sent();\n          valuesAndIndices = [];\n          for (i = 0; i < values.length; i++) {\n            valuesAndIndices.push({\n              value: values[i],\n              index: i\n            });\n          }\n          valuesAndIndices.sort(function (a, b) {\n            return b.value - a.value;\n          });\n          topkValues = new Float32Array(topK);\n          topkIndices = new Int32Array(topK);\n          for (i = 0; i < topK; i++) {\n            topkValues[i] = valuesAndIndices[i].value;\n            topkIndices[i] = valuesAndIndices[i].index;\n          }\n          topClassesAndProbs = [];\n          for (i = 0; i < topkIndices.length; i++) {\n            topClassesAndProbs.push({\n              className: nsfw_classes_1.NSFW_CLASSES[topkIndices[i]],\n              probability: topkValues[i]\n            });\n          }\n          return [2, topClassesAndProbs];\n      }\n    });\n  });\n}","map":{"version":3,"names":["require","__createBinding","Object","create","o","m","k","k2","undefined","defineProperty","enumerable","get","__setModuleDefault","v","value","__importStar","mod","__esModule","result","prototype","hasOwnProperty","call","__awaiter","thisArg","_arguments","P","generator","adopt","resolve","Promise","reject","fulfilled","step","next","e","rejected","done","then","apply","__generator","body","_","label","sent","t","trys","ops","f","y","g","verb","Symbol","iterator","n","op","TypeError","pop","length","push","__importDefault","exports","NSFWJS","load","tf","nsfw_classes_1","gif_frames_1","BASE_PATH","IMAGE_SIZE","base","options","size","nsfwnet","_a","Error","modelPathBaseOrIOHandler","intermediateModels","normalizationOffset","scalar","startsWith","endsWith","pathOrIOHandler","type","_b","_c","_this","_d","loadGraphModel","model","loadLayersModel","endpoints","layers","map","l","name","tidy","predict","zeros","data","dispose","infer","img","endpoint","indexOf","Tensor","browser","fromPixels","normalized","toFloat","div","resized","shape","alignCorners","image","resizeBilinear","batched","reshape","layer","find","inputs","outputs","output","classify","topk","logits","classes","getTopKClasses","classifyGif","gif","config","frameData","acceptedFrames","totalTimeInMs","i","totalFrames","interval","arrayOfPredictions","predictions","Buffer","isBuffer","default","url","frames","outputType","src","fps","_element","index","frameInfo","delay","Math","floor","getImage","onFrame","topK","values","valuesAndIndices","topkValues","topkIndices","topClassesAndProbs","sort","a","b","Float32Array","Int32Array","className","NSFW_CLASSES","probability"],"sources":["/Users/yezery/Desktop/OASIS/OASIS_Interface/node_modules/.store/nsfwjs@2.4.2/node_modules/nsfwjs/dist/index.js"],"sourcesContent":["\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.NSFWJS = exports.load = void 0;\r\nvar tf = __importStar(require(\"@tensorflow/tfjs\"));\r\nvar nsfw_classes_1 = require(\"./nsfw_classes\");\r\nvar gif_frames_1 = __importDefault(require(\"@nsfw-filter/gif-frames\"));\r\nvar BASE_PATH = \"https://d1zv2aa70wpiur.cloudfront.net/tfjs_quant_nsfw_mobilenet/\";\r\nvar IMAGE_SIZE = 224;\r\nfunction load(base, options) {\r\n    if (base === void 0) { base = BASE_PATH; }\r\n    if (options === void 0) { options = { size: IMAGE_SIZE }; }\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var nsfwnet;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    if (tf == null) {\r\n                        throw new Error(\"Cannot find TensorFlow.js. If you are using a <script> tag, please \" +\r\n                            \"also include @tensorflow/tfjs on the page before using this model.\");\r\n                    }\r\n                    options.size = options.size || IMAGE_SIZE;\r\n                    nsfwnet = new NSFWJS(base, options);\r\n                    return [4, nsfwnet.load()];\r\n                case 1:\r\n                    _a.sent();\r\n                    return [2, nsfwnet];\r\n            }\r\n        });\r\n    });\r\n}\r\nexports.load = load;\r\nvar NSFWJS = (function () {\r\n    function NSFWJS(modelPathBaseOrIOHandler, options) {\r\n        this.intermediateModels = {};\r\n        this.options = options;\r\n        this.normalizationOffset = tf.scalar(255);\r\n        if (typeof modelPathBaseOrIOHandler === \"string\" &&\r\n            !modelPathBaseOrIOHandler.startsWith(\"indexeddb://\") &&\r\n            !modelPathBaseOrIOHandler.startsWith(\"localstorage://\")) {\r\n            if (modelPathBaseOrIOHandler.endsWith(\"model.json\")) {\r\n                this.pathOrIOHandler = modelPathBaseOrIOHandler;\r\n            }\r\n            else {\r\n                this.pathOrIOHandler = modelPathBaseOrIOHandler + \"model.json\";\r\n            }\r\n        }\r\n        else {\r\n            this.pathOrIOHandler = modelPathBaseOrIOHandler;\r\n        }\r\n    }\r\n    NSFWJS.prototype.load = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a, size, type, _b, _c, result;\r\n            var _this = this;\r\n            return __generator(this, function (_d) {\r\n                switch (_d.label) {\r\n                    case 0:\r\n                        _a = this.options, size = _a.size, type = _a.type;\r\n                        if (!(type === \"graph\")) return [3, 2];\r\n                        _b = this;\r\n                        return [4, tf.loadGraphModel(this.pathOrIOHandler)];\r\n                    case 1:\r\n                        _b.model = _d.sent();\r\n                        return [3, 4];\r\n                    case 2:\r\n                        _c = this;\r\n                        return [4, tf.loadLayersModel(this.pathOrIOHandler)];\r\n                    case 3:\r\n                        _c.model = _d.sent();\r\n                        this.endpoints = this.model.layers.map(function (l) { return l.name; });\r\n                        _d.label = 4;\r\n                    case 4:\r\n                        result = tf.tidy(function () {\r\n                            return _this.model.predict(tf.zeros([1, size, size, 3]));\r\n                        });\r\n                        return [4, result.data()];\r\n                    case 5:\r\n                        _d.sent();\r\n                        result.dispose();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    NSFWJS.prototype.infer = function (img, endpoint) {\r\n        var _this = this;\r\n        if (endpoint != null && this.endpoints.indexOf(endpoint) === -1) {\r\n            throw new Error(\"Unknown endpoint \" + endpoint + \". Available endpoints: \" +\r\n                (this.endpoints + \".\"));\r\n        }\r\n        return tf.tidy(function () {\r\n            if (!(img instanceof tf.Tensor)) {\r\n                img = tf.browser.fromPixels(img);\r\n            }\r\n            var normalized = img\r\n                .toFloat()\r\n                .div(_this.normalizationOffset);\r\n            var resized = normalized;\r\n            var size = _this.options.size;\r\n            if (img.shape[0] !== size || img.shape[1] !== size) {\r\n                var alignCorners = true;\r\n                resized = tf.image.resizeBilinear(normalized, [size, size], alignCorners);\r\n            }\r\n            var batched = resized.reshape([1, size, size, 3]);\r\n            var model;\r\n            if (endpoint == null) {\r\n                model = _this.model;\r\n            }\r\n            else {\r\n                if (_this.model.hasOwnProperty(\"layers\") &&\r\n                    _this.intermediateModels[endpoint] == null) {\r\n                    var layer = _this.model.layers.find(function (l) { return l.name === endpoint; });\r\n                    _this.intermediateModels[endpoint] = tf.model({\r\n                        inputs: _this.model.inputs,\r\n                        outputs: layer.output,\r\n                    });\r\n                }\r\n                model = _this.intermediateModels[endpoint];\r\n            }\r\n            return model.predict(batched);\r\n        });\r\n    };\r\n    NSFWJS.prototype.classify = function (img, topk) {\r\n        if (topk === void 0) { topk = 5; }\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var logits, classes;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        logits = this.infer(img);\r\n                        return [4, getTopKClasses(logits, topk)];\r\n                    case 1:\r\n                        classes = _a.sent();\r\n                        logits.dispose();\r\n                        return [2, classes];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    NSFWJS.prototype.classifyGif = function (gif, config) {\r\n        if (config === void 0) { config = { topk: 5 }; }\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var frameData, acceptedFrames, totalTimeInMs, i, totalFrames, interval, i, arrayOfPredictions, i, image, predictions;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        frameData = [];\r\n                        if (!Buffer.isBuffer(gif)) return [3, 2];\r\n                        return [4, gif_frames_1.default({ url: gif, frames: 'all', outputType: 'jpg' })];\r\n                    case 1:\r\n                        frameData = _a.sent();\r\n                        return [3, 4];\r\n                    case 2: return [4, gif_frames_1.default({ url: gif.src, frames: 'all', outputType: 'canvas' })];\r\n                    case 3:\r\n                        frameData = _a.sent();\r\n                        _a.label = 4;\r\n                    case 4:\r\n                        acceptedFrames = [];\r\n                        if (typeof config.fps !== 'number') {\r\n                            acceptedFrames = frameData.map(function (_element, index) { return index; });\r\n                        }\r\n                        else {\r\n                            totalTimeInMs = 0;\r\n                            for (i = 0; i < frameData.length; i++) {\r\n                                totalTimeInMs = totalTimeInMs + (frameData[i].frameInfo.delay * 10);\r\n                            }\r\n                            totalFrames = Math.floor(totalTimeInMs / 1000 * config.fps);\r\n                            if (totalFrames <= 1) {\r\n                                acceptedFrames = [Math.floor(frameData.length / 2)];\r\n                            }\r\n                            else if (totalFrames >= frameData.length) {\r\n                                acceptedFrames = frameData.map(function (_element, index) { return index; });\r\n                            }\r\n                            else {\r\n                                interval = Math.floor(frameData.length / (totalFrames + 1));\r\n                                for (i = 1; i <= totalFrames; i++) {\r\n                                    acceptedFrames.push(i * interval);\r\n                                }\r\n                            }\r\n                        }\r\n                        arrayOfPredictions = [];\r\n                        i = 0;\r\n                        _a.label = 5;\r\n                    case 5:\r\n                        if (!(i < acceptedFrames.length)) return [3, 8];\r\n                        image = frameData[acceptedFrames[i]].getImage();\r\n                        return [4, this.classify(image, config.topk)];\r\n                    case 6:\r\n                        predictions = _a.sent();\r\n                        if (typeof config.onFrame === 'function') {\r\n                            config.onFrame({\r\n                                index: acceptedFrames[i],\r\n                                totalFrames: frameData.length,\r\n                                predictions: predictions,\r\n                                image: image\r\n                            });\r\n                        }\r\n                        arrayOfPredictions.push(predictions);\r\n                        _a.label = 7;\r\n                    case 7:\r\n                        i++;\r\n                        return [3, 5];\r\n                    case 8: return [2, arrayOfPredictions];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return NSFWJS;\r\n}());\r\nexports.NSFWJS = NSFWJS;\r\nfunction getTopKClasses(logits, topK) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var values, valuesAndIndices, i, topkValues, topkIndices, i, topClassesAndProbs, i;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4, logits.data()];\r\n                case 1:\r\n                    values = _a.sent();\r\n                    valuesAndIndices = [];\r\n                    for (i = 0; i < values.length; i++) {\r\n                        valuesAndIndices.push({ value: values[i], index: i });\r\n                    }\r\n                    valuesAndIndices.sort(function (a, b) {\r\n                        return b.value - a.value;\r\n                    });\r\n                    topkValues = new Float32Array(topK);\r\n                    topkIndices = new Int32Array(topK);\r\n                    for (i = 0; i < topK; i++) {\r\n                        topkValues[i] = valuesAndIndices[i].value;\r\n                        topkIndices[i] = valuesAndIndices[i].index;\r\n                    }\r\n                    topClassesAndProbs = [];\r\n                    for (i = 0; i < topkIndices.length; i++) {\r\n                        topClassesAndProbs.push({\r\n                            className: nsfw_classes_1.NSFW_CLASSES[topkIndices[i]],\r\n                            probability: topkValues[i],\r\n                        });\r\n                    }\r\n                    return [2, topClassesAndProbs];\r\n            }\r\n        });\r\n    });\r\n}\r\n//# sourceMappingURL=index.js.map"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}