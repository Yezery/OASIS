{"ast":null,"code":"import { adverts } from '../adverts.js';\nimport { BYEBYE, ALIVE } from '../commands/notify.js';\nimport { broadcastAdvert } from './broadcast-advert.js';\nimport { createLocation } from './create-location.js';\nimport { parseAdvertOptions } from './parse-options.js';\nexport async function advertise(ssdp, options) {\n  const advert = parseAdvertOptions(ssdp, options);\n  const shutDownServers = await createLocation(ssdp, advert);\n  let timeout;\n  const broadcast = () => {\n    broadcastAdvert(ssdp, advert, ALIVE);\n    timeout = setTimeout(broadcast, advert.interval);\n  };\n  // send ssdp:byebye then ssdp:alive\n  // see: https://msdn.microsoft.com/en-us/library/cc247331.aspx\n  broadcastAdvert(ssdp, advert, BYEBYE);\n  broadcast();\n  const ad = {\n    service: advert,\n    stop: async () => {\n      clearTimeout(timeout);\n      // tell the network we are going away\n      broadcastAdvert(ssdp, advert, BYEBYE);\n      await shutDownServers();\n      // remove advert from list\n      adverts.remove(ad);\n    }\n  };\n  adverts.add(ad);\n  return ad;\n}","map":{"version":3,"names":["adverts","BYEBYE","ALIVE","broadcastAdvert","createLocation","parseAdvertOptions","advertise","ssdp","options","advert","shutDownServers","timeout","broadcast","setTimeout","interval","ad","service","stop","clearTimeout","remove","add"],"sources":["../../../src/advertise/index.ts"],"sourcesContent":[null],"mappings":"AAAA,SAASA,OAAO,QAA2B,eAAe;AAC1D,SAASC,MAAM,EAAEC,KAAK,QAAQ,uBAAuB;AACrD,SAASC,eAAe,QAAQ,uBAAuB;AACvD,SAASC,cAAc,QAAQ,sBAAsB;AACrD,SAASC,kBAAkB,QAAQ,oBAAoB;AAavD,OAAO,eAAeC,SAASA,CAAEC,IAAU,EAAEC,OAAqB;EAChE,MAAMC,MAAM,GAAGJ,kBAAkB,CAACE,IAAI,EAAEC,OAAO,CAAC;EAChD,MAAME,eAAe,GAAG,MAAMN,cAAc,CAACG,IAAI,EAAEE,MAAM,CAAC;EAC1D,IAAIE,OAAuB;EAE3B,MAAMC,SAAS,GAAGA,CAAA,KAAW;IAC3BT,eAAe,CAACI,IAAI,EAAEE,MAAM,EAAEP,KAAK,CAAC;IAEpCS,OAAO,GAAGE,UAAU,CAACD,SAAS,EAAEH,MAAM,CAACK,QAAQ,CAAC;EAClD,CAAC;EAED;EACA;EACAX,eAAe,CAACI,IAAI,EAAEE,MAAM,EAAER,MAAM,CAAC;EACrCW,SAAS,EAAE;EAEX,MAAMG,EAAE,GAAG;IACTC,OAAO,EAAEP,MAAM;IACfQ,IAAI,EAAE,MAAAA,CAAA,KAAW;MACfC,YAAY,CAACP,OAAO,CAAC;MAErB;MACAR,eAAe,CAACI,IAAI,EAAEE,MAAM,EAAER,MAAM,CAAC;MAErC,MAAMS,eAAe,EAAE;MAEvB;MACAV,OAAO,CAACmB,MAAM,CAACJ,EAAE,CAAC;IACpB;GACD;EAEDf,OAAO,CAACoB,GAAG,CAACL,EAAE,CAAC;EAEf,OAAOA,EAAE;AACX"},"metadata":{},"sourceType":"module","externalDependencies":[]}