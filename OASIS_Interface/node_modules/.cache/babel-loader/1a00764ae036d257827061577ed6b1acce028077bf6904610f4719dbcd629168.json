{"ast":null,"code":"import \"core-js/modules/es.typed-array.to-reversed.js\";\nimport \"core-js/modules/es.typed-array.to-sorted.js\";\nimport \"core-js/modules/es.typed-array.with.js\";\nimport { fromString as uint8ArrayFromString } from 'uint8arrays/from-string';\nconst ZEROS = '0000000000000000000';\nconst SEVENS = '7777777777777777777';\nconst ZERO_OFFSET = '0'.charCodeAt(0);\nconst USTAR_MAGIC = uint8ArrayFromString('ustar\\x00', 'binary');\nconst USTAR_VER = uint8ArrayFromString('00', 'binary');\nconst MASK = parseInt('7777', 8);\nconst MAGIC_OFFSET = 257;\nconst VERSION_OFFSET = 263;\nconst toTypeflag = function (flag) {\n  switch (flag) {\n    case 'file':\n      return 0;\n    case 'link':\n      return 1;\n    case 'symlink':\n      return 2;\n    case 'character-device':\n      return 3;\n    case 'block-device':\n      return 4;\n    case 'directory':\n      return 5;\n    case 'fifo':\n      return 6;\n    case 'contiguous-file':\n      return 7;\n    case 'pax-header':\n      return 72;\n    default:\n      return 0;\n  }\n};\nconst cksum = function (block) {\n  let sum = 8 * 32;\n  for (let i = 0; i < 148; i++) sum += block[i];\n  for (let j = 156; j < 512; j++) sum += block[j];\n  return sum;\n};\nconst encodeOct = function (val, n) {\n  const str = val.toString(8);\n  if (str.length > n) {\n    return uint8ArrayFromString(SEVENS.slice(0, n) + ' ');\n  }\n  return uint8ArrayFromString(ZEROS.slice(0, n - str.length) + str + ' ');\n};\nconst addLength = function (str) {\n  const len = uint8ArrayFromString(str).byteLength;\n  let digits = Math.floor(Math.log(len) / Math.log(10)) + 1;\n  if (len + digits >= Math.pow(10, digits)) {\n    digits++;\n  }\n  return `${len + digits}${str}`;\n};\nexport function encodePax(opts) {\n  let result = '';\n  if (opts.name != null) {\n    result += addLength(' path=' + opts.name + '\\n');\n  }\n  if (opts.linkname != null) {\n    result += addLength(' linkpath=' + opts.linkname + '\\n');\n  }\n  const pax = opts.pax;\n  if (pax != null) {\n    for (const key in pax) {\n      if (Object.prototype.hasOwnProperty.call(pax, key)) {\n        result += addLength(' ' + key + '=' + pax[key] + '\\n');\n      }\n    }\n  }\n  return uint8ArrayFromString(result);\n}\nexport function encode(opts) {\n  const buf = new Uint8Array(512);\n  let name = opts.name;\n  let prefix = '';\n  if (opts.typeflag === 5 && name[name.length - 1] !== '/') {\n    name += '/';\n  }\n  if (uint8ArrayFromString(name).byteLength !== name.length) {\n    return null; // utf-8\n  }\n\n  while (uint8ArrayFromString(name).byteLength > 100) {\n    const i = name.indexOf('/');\n    if (i === -1) {\n      return null;\n    }\n    prefix += prefix !== '' ? '/' + name.slice(0, i) : name.slice(0, i);\n    name = name.slice(i + 1);\n  }\n  if (uint8ArrayFromString(name).byteLength > 100 || uint8ArrayFromString(prefix).byteLength > 155) {\n    return null;\n  }\n  if (opts.linkname != null && uint8ArrayFromString(opts.linkname).byteLength > 100) {\n    return null;\n  }\n  buf.set(uint8ArrayFromString(name), 0);\n  buf.set(encodeOct(opts.mode & MASK, 6), 100);\n  buf.set(encodeOct(opts.uid, 6), 108);\n  buf.set(encodeOct(opts.gid, 6), 116);\n  buf.set(encodeOct(opts.size, 11), 124);\n  buf.set(encodeOct(opts.mtime.getTime() / 1000 | 0, 11), 136);\n  buf[156] = ZERO_OFFSET + toTypeflag(opts.type);\n  if (opts.linkname != null) {\n    buf.set(uint8ArrayFromString(opts.linkname), 157);\n  }\n  buf.set(USTAR_MAGIC, MAGIC_OFFSET);\n  buf.set(USTAR_VER, VERSION_OFFSET);\n  if (opts.uname != null) {\n    buf.set(uint8ArrayFromString(opts.uname), 265);\n  }\n  if (opts.gname != null) {\n    buf.set(uint8ArrayFromString(opts.gname), 297);\n  }\n  buf.set(encodeOct(opts.devmajor ?? 0, 6), 329);\n  buf.set(encodeOct(opts.devminor ?? 0, 6), 337);\n  if (prefix != null) {\n    buf.set(uint8ArrayFromString(prefix), 345);\n  }\n  buf.set(encodeOct(cksum(buf), 6), 148);\n  return buf;\n}","map":{"version":3,"names":["fromString","uint8ArrayFromString","ZEROS","SEVENS","ZERO_OFFSET","charCodeAt","USTAR_MAGIC","USTAR_VER","MASK","parseInt","MAGIC_OFFSET","VERSION_OFFSET","toTypeflag","flag","cksum","block","sum","i","j","encodeOct","val","n","str","toString","length","slice","addLength","len","byteLength","digits","Math","floor","log","pow","encodePax","opts","result","name","linkname","pax","key","Object","prototype","hasOwnProperty","call","encode","buf","Uint8Array","prefix","typeflag","indexOf","set","mode","uid","gid","size","mtime","getTime","type","uname","gname","devmajor","devminor"],"sources":["../../src/pack-headers.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}