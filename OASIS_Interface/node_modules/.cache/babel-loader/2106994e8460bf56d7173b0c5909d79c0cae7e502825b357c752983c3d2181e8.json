{"ast":null,"code":"import _defineProperty from \"/Users/yezery/Oasis/OASIS/node_modules/.store/@babel+runtime@7.22.15/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nvar _class;\nimport { peerIdFromBytes } from '@libp2p/peer-id';\nimport { arrayEquals } from '@libp2p/utils/array-equals';\nimport { multiaddr } from '@multiformats/multiaddr';\nimport { ENVELOPE_DOMAIN_PEER_RECORD, ENVELOPE_PAYLOAD_TYPE_PEER_RECORD } from './consts.js';\nimport { PeerRecord as Protobuf } from './peer-record.js';\n/**\n * The PeerRecord is used for distributing peer routing records across the network.\n * It contains the peer's reachable listen addresses.\n */\nexport class PeerRecord {\n  constructor(init) {\n    _defineProperty(this, \"peerId\", void 0);\n    _defineProperty(this, \"multiaddrs\", void 0);\n    _defineProperty(this, \"seqNumber\", void 0);\n    _defineProperty(this, \"domain\", PeerRecord.DOMAIN);\n    _defineProperty(this, \"codec\", PeerRecord.CODEC);\n    _defineProperty(this, \"marshaled\", void 0);\n    const {\n      peerId,\n      multiaddrs,\n      seqNumber\n    } = init;\n    this.peerId = peerId;\n    this.multiaddrs = multiaddrs ?? [];\n    this.seqNumber = seqNumber ?? BigInt(Date.now());\n  }\n  /**\n   * Marshal a record to be used in an envelope\n   */\n  marshal() {\n    if (this.marshaled == null) {\n      this.marshaled = Protobuf.encode({\n        peerId: this.peerId.toBytes(),\n        seq: BigInt(this.seqNumber),\n        addresses: this.multiaddrs.map(m => ({\n          multiaddr: m.bytes\n        }))\n      });\n    }\n    return this.marshaled;\n  }\n  /**\n   * Returns true if `this` record equals the `other`\n   */\n  equals(other) {\n    if (!(other instanceof PeerRecord)) {\n      return false;\n    }\n    // Validate PeerId\n    if (!this.peerId.equals(other.peerId)) {\n      return false;\n    }\n    // Validate seqNumber\n    if (this.seqNumber !== other.seqNumber) {\n      return false;\n    }\n    // Validate multiaddrs\n    if (!arrayEquals(this.multiaddrs, other.multiaddrs)) {\n      return false;\n    }\n    return true;\n  }\n}\n_class = PeerRecord;\n/**\n * Unmarshal Peer Record Protobuf\n */\n_defineProperty(PeerRecord, \"createFromProtobuf\", buf => {\n  const peerRecord = Protobuf.decode(buf);\n  const peerId = peerIdFromBytes(peerRecord.peerId);\n  const multiaddrs = (peerRecord.addresses ?? []).map(a => multiaddr(a.multiaddr));\n  const seqNumber = peerRecord.seq;\n  return new _class({\n    peerId,\n    multiaddrs,\n    seqNumber\n  });\n});\n_defineProperty(PeerRecord, \"DOMAIN\", ENVELOPE_DOMAIN_PEER_RECORD);\n_defineProperty(PeerRecord, \"CODEC\", ENVELOPE_PAYLOAD_TYPE_PEER_RECORD);","map":{"version":3,"names":["peerIdFromBytes","arrayEquals","multiaddr","ENVELOPE_DOMAIN_PEER_RECORD","ENVELOPE_PAYLOAD_TYPE_PEER_RECORD","PeerRecord","Protobuf","constructor","init","_defineProperty","DOMAIN","CODEC","peerId","multiaddrs","seqNumber","BigInt","Date","now","marshal","marshaled","encode","toBytes","seq","addresses","map","m","bytes","equals","other","buf","peerRecord","decode","a"],"sources":["../../../src/peer-record/index.ts"],"sourcesContent":[null],"mappings":";;AAAA,SAASA,eAAe,QAAQ,iBAAiB;AACjD,SAASC,WAAW,QAAQ,4BAA4B;AACxD,SAASC,SAAS,QAAQ,yBAAyB;AACnD,SACEC,2BAA2B,EAC3BC,iCAAiC,QAC5B,aAAa;AACpB,SAASC,UAAU,IAAIC,QAAQ,QAAQ,kBAAkB;AAmBzD;;;;AAIA,OAAM,MAAOD,UAAU;EAuBrBE,YAAaC,IAAoB;IAAAC,eAAA;IAAAA,eAAA;IAAAA,eAAA;IAAAA,eAAA,iBAJjBJ,UAAU,CAACK,MAAM;IAAAD,eAAA,gBAClBJ,UAAU,CAACM,KAAK;IAAAF,eAAA;IAI7B,MAAM;MAAEG,MAAM;MAAEC,UAAU;MAAEC;IAAS,CAAE,GAAGN,IAAI;IAE9C,IAAI,CAACI,MAAM,GAAGA,MAAM;IACpB,IAAI,CAACC,UAAU,GAAGA,UAAU,IAAI,EAAE;IAClC,IAAI,CAACC,SAAS,GAAGA,SAAS,IAAIC,MAAM,CAACC,IAAI,CAACC,GAAG,EAAE,CAAC;EAClD;EAEA;;;EAGAC,OAAOA,CAAA;IACL,IAAI,IAAI,CAACC,SAAS,IAAI,IAAI,EAAE;MAC1B,IAAI,CAACA,SAAS,GAAGb,QAAQ,CAACc,MAAM,CAAC;QAC/BR,MAAM,EAAE,IAAI,CAACA,MAAM,CAACS,OAAO,EAAE;QAC7BC,GAAG,EAAEP,MAAM,CAAC,IAAI,CAACD,SAAS,CAAC;QAC3BS,SAAS,EAAE,IAAI,CAACV,UAAU,CAACW,GAAG,CAAEC,CAAC,KAAM;UACrCvB,SAAS,EAAEuB,CAAC,CAACC;SACd,CAAC;OACH,CAAC;;IAGJ,OAAO,IAAI,CAACP,SAAS;EACvB;EAEA;;;EAGAQ,MAAMA,CAAEC,KAAc;IACpB,IAAI,EAAEA,KAAK,YAAYvB,UAAU,CAAC,EAAE;MAClC,OAAO,KAAK;;IAGd;IACA,IAAI,CAAC,IAAI,CAACO,MAAM,CAACe,MAAM,CAACC,KAAK,CAAChB,MAAM,CAAC,EAAE;MACrC,OAAO,KAAK;;IAGd;IACA,IAAI,IAAI,CAACE,SAAS,KAAKc,KAAK,CAACd,SAAS,EAAE;MACtC,OAAO,KAAK;;IAGd;IACA,IAAI,CAACb,WAAW,CAAC,IAAI,CAACY,UAAU,EAAEe,KAAK,CAACf,UAAU,CAAC,EAAE;MACnD,OAAO,KAAK;;IAGd,OAAO,IAAI;EACb;;SAxEWR,UAAU;AACrB;;;AAAAI,eAAA,CADWJ,UAAU,wBAIQwB,GAAgC,IAAgB;EAC3E,MAAMC,UAAU,GAAGxB,QAAQ,CAACyB,MAAM,CAACF,GAAG,CAAC;EACvC,MAAMjB,MAAM,GAAGZ,eAAe,CAAC8B,UAAU,CAAClB,MAAM,CAAC;EACjD,MAAMC,UAAU,GAAG,CAACiB,UAAU,CAACP,SAAS,IAAI,EAAE,EAAEC,GAAG,CAAEQ,CAAC,IAAK9B,SAAS,CAAC8B,CAAC,CAAC9B,SAAS,CAAC,CAAC;EAClF,MAAMY,SAAS,GAAGgB,UAAU,CAACR,GAAG;EAEhC,OAAO,IAAIjB,MAAU,CAAC;IAAEO,MAAM;IAAEC,UAAU;IAAEC;EAAS,CAAE,CAAC;AAC1D,CAAC;AAAAL,eAAA,CAXUJ,UAAU,YAaLF,2BAA2B;AAAAM,eAAA,CAbhCJ,UAAU,WAcND,iCAAiC"},"metadata":{},"sourceType":"module","externalDependencies":[]}